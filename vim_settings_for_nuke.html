<!DOCTYPE html>
<html>
<head>
<link rel="Stylesheet" type="text/css" href="style.css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<title>vim_settings_for_nuke</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<p>
<a href="index.html">index</a>
</p>

<p>
<a href="vim_learning.html">Vim Learning</a>
</p>

<div id="Vim Settings for Nuke"><h1 id="Vim Settings for Nuke" class="header"><a href="#Vim Settings for Nuke">Vim Settings for Nuke</a></h1></div>

<p>
To make Vim automatically treat .nk files as a special filetype with braceâ€‘based folding enabled. That way, whenever you open a Nuke script, folding is ready to go.
</p>

<div id="Vim Settings for Nuke-ğŸ” Step 1: Create a filetype detection rule"><h2 id="ğŸ” Step 1: Create a filetype detection rule" class="header"><a href="#Vim Settings for Nuke-ğŸ” Step 1: Create a filetype detection rule">ğŸ” Step 1: Create a filetype detection rule</a></h2></div>

<p>
Add this to your ~/.vim/filetype.vim (or ~/.vim/ftdetect/nuke.vim):
</p>

<pre vim>
au BufRead,BufNewFile *.nk set filetype=nuke
</pre>
<p>
This tells Vim: â€œWhenever I open a .nk file, set the filetype to nuke.â€
</p>

<div id="Vim Settings for Nuke-ğŸ” Step 2: Define settings for the nuke filetype"><h2 id="ğŸ” Step 2: Define settings for the nuke filetype" class="header"><a href="#Vim Settings for Nuke-ğŸ” Step 2: Define settings for the nuke filetype">ğŸ” Step 2: Define settings for the nuke filetype</a></h2></div>

<p>
Create a file ~/.vim/ftplugin/nuke.vim with:
</p>

<pre vim>
" Enable folding by braces for Nuke scripts
setlocal foldmethod=marker
setlocal foldmarker={,}
setlocal foldenable
</pre>
<p>
This ensures folding is automatically on, using { and } as fold markers.
</p>

<div id="Vim Settings for Nuke-ğŸ” Step 3: Optional syntax highlighting"><h2 id="ğŸ” Step 3: Optional syntax highlighting" class="header"><a href="#Vim Settings for Nuke-ğŸ” Step 3: Optional syntax highlighting">ğŸ” Step 3: Optional syntax highlighting</a></h2></div>

<p>
If you want syntax highlighting for .nk files, you can also create a simple syntax file at ~/.vim/syntax/nuke.vim. For example:
</p>

<pre vim>
syntax keyword nukeNode Read Write Shuffle Remove
syntax match nukeBrace "{"
syntax match nukeBrace "}"

highlight link nukeNode Keyword
highlight link nukeBrace Delimiter
</pre>
<p>
This isnâ€™t required for folding, but it makes .nk files easier to read.
</p>

<div id="Vim Settings for Nuke-âœ… Result"><h2 id="âœ… Result" class="header"><a href="#Vim Settings for Nuke-âœ… Result">âœ… Result</a></h2></div>

<p>
Now, whenever you open a Nuke scene file (.nk):
</p>

<ul>
<li>
Vim sets the filetype to nuke.

<li>
Folding is enabled automatically, with { and } as fold markers.

<li>
You can fold/unfold blocks with zc, zo, za, etc.

</ul>
<div id="Vim Settings for Nuke-âš¡ Summary:"><h2 id="âš¡ Summary:" class="header"><a href="#Vim Settings for Nuke-âš¡ Summary:">âš¡ Summary:</a></h2></div>

<p>
Define a custom filetype for .nk files (nuke), then add an ftplugin that sets foldmethod=marker and foldmarker={,}. This way, brace folding is always enabled when editing Nuke scripts.
</p>

<p>
Would you like me to also show you how to add a custom fold text function so folded blocks display the node name (e.g. Read {â€¦}) instead of just +-- { â€¦ }?
</p>


<div id="Adding Fold Labels"><h1 id="Adding Fold Labels" class="header"><a href="#Adding Fold Labels">Adding Fold Labels</a></h1></div>

<p>
Letâ€™s make folded blocks in your .nk files display something more meaningful than just {â€¦}. In Vim you can customize the text shown for a fold with the foldtext option. By writing a small function, you can show the node name (the first word of the block) instead of the generic fold marker.
</p>

<div id="Adding Fold Labels-ğŸ” Step 1: Define a foldtext function"><h3 id="ğŸ” Step 1: Define a foldtext function" class="header"><a href="#Adding Fold Labels-ğŸ” Step 1: Define a foldtext function">ğŸ” Step 1: Define a foldtext function</a></h3></div>

<p>
Add this to your ~/.vim/ftplugin/nuke.vim:
</p>

<pre vim>
function! NukeFoldText()
  " Get the first line of the fold
  let lnum = v:foldstart
  let line = getline(lnum)

  " Trim leading/trailing whitespace
  let line = substitute(line, '^\s*', '', '')
  let line = substitute(line, '\s*$', '', '')

  " Show node name plus fold size
  return line . ' â€¦ ' . (v:foldend - v:foldstart + 1) . ' lines'
endfunction

setlocal foldtext=NukeFoldText()
</pre>

<div id="Adding Fold Labels-ğŸ” Step 2: How it works"><h2 id="ğŸ” Step 2: How it works" class="header"><a href="#Adding Fold Labels-ğŸ” Step 2: How it works">ğŸ” Step 2: How it works</a></h2></div>

<ul>
<li>
<span id="Adding Fold Labels-ğŸ” Step 2: How it works-v"></span><strong id="v">v</strong>:foldstart and v:foldend are special Vim variables pointing to the first and last line of the fold.

<li>
<span id="Adding Fold Labels-ğŸ” Step 2: How it works-getline(v"></span><strong id="getline(v">getline(v</strong>:foldstart) grabs the first line (usually something like Read {).

<li>
The function returns a string that becomes the foldâ€™s label in the editor.

</ul>
<p>
Example:
</p>

<pre>
Read { â€¦ 25 lines
</pre>

<div id="Adding Fold Labels-ğŸ› ï¸ Optional Enhancements"><h2 id="ğŸ› ï¸ Optional Enhancements" class="header"><a href="#Adding Fold Labels-ğŸ› ï¸ Optional Enhancements">ğŸ› ï¸ Optional Enhancements</a></h2></div>

<p>
Highlight the node type only:
</p>

<pre vim>
let node = matchstr(line, '^\w\+')
return node . ' block â€¦ ' . (v:foldend - v:foldstart + 1) . ' lines'

Add icons or special characters if your font supports them.

== âœ… Result ==

Now when you fold a block in a Nuke .nk file:

* Instead of +-- { â€¦ }, youâ€™ll see something like:

{{{
Transform { â€¦ 18 lines
</pre>

<p>
Much easier to navigate large scripts.
</p>

<div id="Adding Fold Labels-ğŸ› ï¸ Optional Enhancements-âš¡ Summary:"><h3 id="âš¡ Summary:" class="header"><a href="#Adding Fold Labels-ğŸ› ï¸ Optional Enhancements-âš¡ Summary:">âš¡ Summary:</a></h3></div>

<p>
Define a custom foldtext function in your ftplugin/nuke.vim that grabs the first line of the fold and displays the node name plus the number of lines. This makes folded blocks in Nuke scripts far more informative.
</p>

<div id="Color Markers"><h1 id="Color Markers" class="header"><a href="#Color Markers">Color Markers</a></h1></div>

<p>
Letâ€™s make your folded blocks in Vim not only show the node name but also stand out visually with custom highlighting. By default, Vim uses the Folded highlight group for fold text. You can override this or even define your own group and apply it inside your foldtext function.
</p>

<div id="Color Markers-ğŸ” Step 1: Define a custom highlight group"><h2 id="ğŸ” Step 1: Define a custom highlight group" class="header"><a href="#Color Markers-ğŸ” Step 1: Define a custom highlight group">ğŸ” Step 1: Define a custom highlight group</a></h2></div>

<p>
In your ~/.vim/ftplugin/nuke.vim (or colorscheme file), add:
</p>

<pre vim>
" Define a custom highlight group for node names
highlight NukeFoldNode ctermfg=Yellow guifg=#FFD700 cterm=bold gui=bold
</pre>

<p>
This makes node names appear bold yellow in both terminal and GUI Vim.
</p>

<div id="Color Markers-ğŸ” Step 1: Define a custom highlight group-ğŸ” Step 2: Update your foldtext function"><h3 id="ğŸ” Step 2: Update your foldtext function" class="header"><a href="#Color Markers-ğŸ” Step 1: Define a custom highlight group-ğŸ” Step 2: Update your foldtext function">ğŸ” Step 2: Update your foldtext function</a></h3></div>

<p>
Modify your earlier NukeFoldText() to embed the highlight group:
</p>

<pre vim>
function! NukeFoldText()
  let lnum = v:foldstart
  let line = getline(lnum)

  " Extract node name (first word)
  let node = matchstr(line, '^\w\+')

  " Build fold text with highlighting
  return printf('%s%s%s â€¦ %d lines',
        \ '%#NukeFoldNode#', node, '%#Folded#',
        \ (v:foldend - v:foldstart + 1))
endfunction

setlocal foldtext=NukeFoldText()
</pre>

<div id="Color Markers-ğŸ” Step 1: Define a custom highlight group-ğŸ” How It Works"><h3 id="ğŸ” How It Works" class="header"><a href="#Color Markers-ğŸ” Step 1: Define a custom highlight group-ğŸ” How It Works">ğŸ” How It Works</a></h3></div>

<ul>
<li>
%#GroupName# switches highlighting to a specific group.

<li>
%#Folded# switches back to the default fold text style.

<li>
So the node name is highlighted with NukeFoldNode, while the rest uses the normal fold style.

</ul>
<div id="Color Markers-ğŸ” Step 1: Define a custom highlight group-âœ… Example Result"><h3 id="âœ… Example Result" class="header"><a href="#Color Markers-ğŸ” Step 1: Define a custom highlight group-âœ… Example Result">âœ… Example Result</a></h3></div>

<p>
When you fold a block like:
</p>

<pre>
Read {
   file /path/to/image.exr
   ...
}
</pre>

<p>
The fold line will display something like:
</p>

<pre>
Read â€¦ 12 lines
</pre>

<p>
with â€œReadâ€ in bold yellow, and the rest in the standard folded style.
</p>

<div id="Color Markers-ğŸ” Step 1: Define a custom highlight group-âš¡ Summary:"><h3 id="âš¡ Summary:" class="header"><a href="#Color Markers-ğŸ” Step 1: Define a custom highlight group-âš¡ Summary:">âš¡ Summary:</a></h3></div>

<p>
Define a custom highlight group (NukeFoldNode), then use %#GroupName# inside your foldtext function to colorize the node name differently from the rest of the fold text. This makes folded blocks in Nuke .nk files visually distinctive and easier to scan.
</p>

<div id="Glyphs for Node Types"><h1 id="Glyphs for Node Types" class="header"><a href="#Glyphs for Node Types">Glyphs for Node Types</a></h1></div>

<p>
Letâ€™s add some icons/glyphs to your fold text so folded Nuke blocks are even easier to scan. Vimâ€™s foldtext function can return any string, including Unicode characters or emoji, so you can decorate the fold labels.
</p>

<div id="Glyphs for Node Types-ğŸ” Example Foldtext with Icons"><h2 id="ğŸ” Example Foldtext with Icons" class="header"><a href="#Glyphs for Node Types-ğŸ” Example Foldtext with Icons">ğŸ” Example Foldtext with Icons</a></h2></div>

<p>
Update your ~/.vim/ftplugin/nuke.vim:
</p>

<pre vim>
function! NukeFoldText()
  let lnum = v:foldstart
  let line = getline(lnum)

  " Extract node name (first word)
  let node = matchstr(line, '^\w\+')

  " Choose an icon based on node type
  let icon = 'ğŸ“¦'   " default
  if node =~? 'Read'
    let icon = 'ğŸ“¥'
  elseif node =~? 'Write'
    let icon = 'ğŸ“¤'
  elseif node =~? 'Shuffle'
    let icon = 'ğŸ”€'
  elseif node =~? 'Transform'
    let icon = 'ğŸ”§'
  endif

  " Build fold text with highlighting and icon
  return printf('%s %s%s%s â€¦ %d lines',
        \ icon,
        \ '%#NukeFoldNode#', node, '%#Folded#',
        \ (v:foldend - v:foldstart + 1))
endfunction

setlocal foldtext=NukeFoldText()
</pre>

<div id="Glyphs for Node Types-ğŸ” Example Foldtext with Icons-ğŸ› ï¸ How It Works"><h3 id="ğŸ› ï¸ How It Works" class="header"><a href="#Glyphs for Node Types-ğŸ” Example Foldtext with Icons-ğŸ› ï¸ How It Works">ğŸ› ï¸ How It Works</a></h3></div>

<ul>
<li>
<code>icon</code> is chosen based on the node type.

<li>
Unicode glyphs like ğŸ“¥, ğŸ“¤, ğŸ”€, ğŸ”§ make folds visually distinctive.

<li>
<code>%#NukeFoldNode#</code> applies your custom highlight group to the node name.

<li>
<code>%#Folded#</code> switches back to the default fold style for the rest.

</ul>
<div id="Glyphs for Node Types-ğŸ” Example Foldtext with Icons-âœ… Example Result"><h3 id="âœ… Example Result" class="header"><a href="#Glyphs for Node Types-ğŸ” Example Foldtext with Icons-âœ… Example Result">âœ… Example Result</a></h3></div>

<p>
Folded blocks might look like:
</p>

<pre>
ğŸ“¥ Read â€¦ 12 lines
ğŸ“¤ Write â€¦ 8 lines
ğŸ”€ Shuffle â€¦ 15 lines
ğŸ”§ Transform â€¦ 20 lines
</pre>

<div id="Glyphs for Node Types-ğŸ” Example Foldtext with Icons-âš¡ Summary"><h3 id="âš¡ Summary" class="header"><a href="#Glyphs for Node Types-ğŸ” Example Foldtext with Icons-âš¡ Summary">âš¡ Summary</a></h3></div>

<p>
By adding Unicode glyphs or emoji in your foldtext function, you can decorate folded Nuke node blocks with icons that reflect their type. Combined with custom highlighting, this makes large .nk scripts much more navigable.
</p>

<div id="Unknown Nodes"><h1 id="Unknown Nodes" class="header"><a href="#Unknown Nodes">Unknown Nodes</a></h1></div>

<p>
Letâ€™s make sure every fold always has an icon, even if the node type isnâ€™t one of the ones youâ€™ve explicitly listed. Weâ€™ll add a default glyph (âš™ï¸ for â€œgeneric nodeâ€) and only override it when we recognize a specific type.
</p>

<div id="Unknown Nodes-ğŸ” Updated Foldtext Function"><h2 id="ğŸ” Updated Foldtext Function" class="header"><a href="#Unknown Nodes-ğŸ” Updated Foldtext Function">ğŸ” Updated Foldtext Function</a></h2></div>

<p>
Put this in your ~/.vim/ftplugin/nuke.vim:
</p>

<pre vim>
function! NukeFoldText()
  let lnum = v:foldstart
  let line = getline(lnum)

  " Extract node name (first word of the block)
  let node = matchstr(line, '^\w\+')

  " Default icon
  let icon = 'âš™ï¸'

  " Assign icons for known node types
  if node =~? 'Read'
    let icon = 'ğŸ“¥'
  elseif node =~? 'Write'
    let icon = 'ğŸ“¤'
  elseif node =~? 'Shuffle'
    let icon = 'ğŸ”€'
  elseif node =~? 'Transform'
    let icon = 'ğŸ”§'
  elseif node =~? 'Remove'
    let icon = 'âŒ'
  elseif node =~? 'Merge'
    let icon = 'ğŸ§©'
  endif

  " Build fold text with highlighting and icon
  return printf('%s %s%s%s â€¦ %d lines',
        \ icon,
        \ '%#NukeFoldNode#', node, '%#Folded#',
        \ (v:foldend - v:foldstart + 1))
endfunction

setlocal foldtext=NukeFoldText()
</pre>

<div id="Unknown Nodes-ğŸ” Updated Foldtext Function-ğŸ› ï¸ How It Works"><h3 id="ğŸ› ï¸ How It Works" class="header"><a href="#Unknown Nodes-ğŸ” Updated Foldtext Function-ğŸ› ï¸ How It Works">ğŸ› ï¸ How It Works</a></h3></div>

<ul>
<li>
<code>node = matchstr(line, '^\w\+')</code> grabs the node name (first word).

<li>
<code>icon</code> defaults to âš™ï¸.

<li>
If the node matches a known type, we override with a specific glyph.

<li>
<code>%#NukeFoldNode#</code> highlights the node name, %#Folded# resets back to normal fold style.

<li>
The fold text shows: ğŸ“¥ Read â€¦ 12 lines or âš™ï¸ UnknownNode â€¦ 20 lines.

</ul>
<div id="Unknown Nodes-ğŸ” Updated Foldtext Function-âœ… Example Result"><h3 id="âœ… Example Result" class="header"><a href="#Unknown Nodes-ğŸ” Updated Foldtext Function-âœ… Example Result">âœ… Example Result</a></h3></div>

<pre>
ğŸ“¥ Read â€¦ 12 lines
ğŸ“¤ Write â€¦ 8 lines
ğŸ”€ Shuffle â€¦ 15 lines
ğŸ”§ Transform â€¦ 20 lines
âš™ï¸ CustomNode â€¦ 30 lines
</pre>

<div id="Unknown Nodes-ğŸ” Updated Foldtext Function-âš¡ Summary:"><h3 id="âš¡ Summary:" class="header"><a href="#Unknown Nodes-ğŸ” Updated Foldtext Function-âš¡ Summary:">âš¡ Summary:</a></h3></div>

<p>
By adding a default glyph (âš™ï¸) and only overriding it for known node types, you guarantee that every fold line in your Nuke .nk files has an icon. This makes navigation consistent and visually distinctive, even for custom or unknown nodes.
</p>

<div id="Number of Inputs"><h1 id="Number of Inputs" class="header"><a href="#Number of Inputs">Number of Inputs</a></h1></div>

<p>
Letâ€™s extend your fold text so it not only shows the icon and node name, but also the number of inputs/outputs that node has. This makes folded blocks even more informative when scanning a big Nuke script.
</p>

<div id="Number of Inputs-ğŸ” How to Detect Inputs/Outputs"><h2 id="ğŸ” How to Detect Inputs/Outputs" class="header"><a href="#Number of Inputs-ğŸ” How to Detect Inputs/Outputs">ğŸ” How to Detect Inputs/Outputs</a></h2></div>

<p>
In a .nk file, each node block often contains lines like:
</p>

<pre>
inputs 2
</pre>
<p>
or
</p>

<pre>
input0 Read1
input1 Transform1
</pre>

<p>
So we can scan the folded block between v:foldstart and v:foldend for those keywords.
</p>

<div id="Number of Inputs-ğŸ› ï¸ Updated Foldtext Function"><h2 id="ğŸ› ï¸ Updated Foldtext Function" class="header"><a href="#Number of Inputs-ğŸ› ï¸ Updated Foldtext Function">ğŸ› ï¸ Updated Foldtext Function</a></h2></div>

<p>
Add this to your ~/.vim/ftplugin/nuke.vim:
</p>

<pre vim>
function! NukeFoldText()
  let lnum = v:foldstart
  let line = getline(lnum)

  " Extract node name (first word of the block)
  let node = matchstr(line, '^\w\+')

  " Default icon
  let icon = 'âš™ï¸'
  if node =~? 'Read'
    let icon = 'ğŸ“¥'
  elseif node =~? 'Write'
    let icon = 'ğŸ“¤'
  elseif node =~? 'Shuffle'
    let icon = 'ğŸ”€'
  elseif node =~? 'Transform'
    let icon = 'ğŸ”§'
  elseif node =~? 'Remove'
    let icon = 'âŒ'
  elseif node =~? 'Merge'
    let icon = 'ğŸ§©'
  endif

  " Detect inputs/outputs by scanning folded lines
  let inputs = 0
  let outputs = 0
  for i in range(v:foldstart, v:foldend)
    let l = getline(i)
    if l =~? '^inputs'
      let inputs = str2nr(matchstr(l, '\d\+'))
    elseif l =~? '^outputs'
      let outputs = str2nr(matchstr(l, '\d\+'))
    endif
  endfor

  " Build fold text with icon, node name, I/O counts, and line count
  return printf('%s %s%s%s (in:%d out:%d) â€¦ %d lines',
        \ icon,
        \ '%#NukeFoldNode#', node, '%#Folded#',
        \ inputs, outputs,
        \ (v:foldend - v:foldstart + 1))
endfunction

setlocal foldtext=NukeFoldText()
</pre>

<div id="Number of Inputs-ğŸ› ï¸ Updated Foldtext Function-âœ… Example Result"><h3 id="âœ… Example Result" class="header"><a href="#Number of Inputs-ğŸ› ï¸ Updated Foldtext Function-âœ… Example Result">âœ… Example Result</a></h3></div>

<p>
When folding a block like:
</p>

<pre>
Merge {
  inputs 2
  outputs 1
  ...
}
</pre>

<p>
The fold line will display:
</p>

<pre>
ğŸ§© Merge (in:2 out:1) â€¦ 25 lines
</pre>

<div id="Number of Inputs-ğŸ› ï¸ Updated Foldtext Function-âš¡ Summary"><h3 id="âš¡ Summary" class="header"><a href="#Number of Inputs-ğŸ› ï¸ Updated Foldtext Function-âš¡ Summary">âš¡ Summary</a></h3></div>

<p>
By scanning the folded block for inputs and outputs lines, you can display the nodeâ€™s connectivity right in the fold text. Combined with icons and highlighting, this gives you a compact â€œdashboardâ€ view of your Nuke script inside Vim.
</p>

<div id="Show disconnected nodes"><h1 id="Show disconnected nodes" class="header"><a href="#Show disconnected nodes">Show disconnected nodes</a></h1></div>

<p>
Letâ€™s extend the fold text so the input/output counts are colorâ€‘coded. Vim lets you switch highlight groups inline with %#GroupName# inside your foldtext function. Weâ€™ll define two groups: one for â€œgoodâ€ (green) and one for â€œbadâ€ (red), then apply them depending on the values.
</p>

<div id="Show disconnected nodes-ğŸ” Step 1: Define highlight groups"><h2 id="ğŸ” Step 1: Define highlight groups" class="header"><a href="#Show disconnected nodes-ğŸ” Step 1: Define highlight groups">ğŸ” Step 1: Define highlight groups</a></h2></div>

<p>
Add these to your ~/.vim/ftplugin/nuke.vim or your colorscheme:
</p>

<pre vim>
highlight NukeFoldNode   ctermfg=Yellow guifg=#FFD700 cterm=bold gui=bold
highlight NukeFoldGood   ctermfg=Green  guifg=#00FF00 cterm=bold gui=bold
highlight NukeFoldBad    ctermfg=Red    guifg=#FF0000 cterm=bold gui=bold
</pre>

<div id="Show disconnected nodes-ğŸ” Step 2: Update the foldtext function"><h2 id="ğŸ” Step 2: Update the foldtext function" class="header"><a href="#Show disconnected nodes-ğŸ” Step 2: Update the foldtext function">ğŸ” Step 2: Update the foldtext function</a></h2></div>

<pre vim>
function! NukeFoldText()
  let lnum = v:foldstart
  let line = getline(lnum)

  " Extract node name
  let node = matchstr(line, '^\w\+')

  " Default icon
  let icon = 'âš™ï¸'
  if node =~? 'Read'
    let icon = 'ğŸ“¥'
  elseif node =~? 'Write'
    let icon = 'ğŸ“¤'
  elseif node =~? 'Shuffle'
    let icon = 'ğŸ”€'
  elseif node =~? 'Transform'
    let icon = 'ğŸ”§'
  elseif node =~? 'Remove'
    let icon = 'âŒ'
  elseif node =~? 'Merge'
    let icon = 'ğŸ§©'
  endif

  " Detect inputs/outputs
  let inputs = 0
  let outputs = 0
  for i in range(v:foldstart, v:foldend)
    let l = getline(i)
    if l =~? '^inputs'
      let inputs = str2nr(matchstr(l, '\d\+'))
    elseif l =~? '^outputs'
      let outputs = str2nr(matchstr(l, '\d\+'))
    endif
  endfor

  " Choose highlight groups based on values
  let inGroup  = (inputs  &gt; 0 ? '%#NukeFoldGood#' : '%#NukeFoldBad#')
  let outGroup = (outputs &gt; 0 ? '%#NukeFoldGood#' : '%#NukeFoldBad#')

  " Build fold text
  return printf('%s %s%s%s (in:%s%d%s out:%s%d%s) â€¦ %d lines',
        \ icon,
        \ '%#NukeFoldNode#', node, '%#Folded#',
        \ inGroup, inputs, '%#Folded#',
        \ outGroup, outputs, '%#Folded#',
        \ (v:foldend - v:foldstart + 1))
endfunction

setlocal foldtext=NukeFoldText()
</pre>

<div id="Show disconnected nodes-ğŸ” Step 2: Update the foldtext function-âœ… Example Result"><h3 id="âœ… Example Result" class="header"><a href="#Show disconnected nodes-ğŸ” Step 2: Update the foldtext function-âœ… Example Result">âœ… Example Result</a></h3></div>

<p>
Folded blocks will now look like:
</p>

<pre>
ğŸ§© Merge (in:2 out:1) â€¦ 25 lines
ğŸ“¤ Write (in:0 out:0) â€¦ 10 lines
</pre>

<ul>
<li>
The node name is bold yellow.

<li>
Input/output counts are green if &gt;0, red if 0.

<li>
Icons help distinguish node types.

</ul>
<div id="Show disconnected nodes-ğŸ” Step 2: Update the foldtext function-âš¡ Summary"><h3 id="âš¡ Summary" class="header"><a href="#Show disconnected nodes-ğŸ” Step 2: Update the foldtext function-âš¡ Summary">âš¡ Summary</a></h3></div>

<p>
By defining NukeFoldGood and NukeFoldBad highlight groups and switching between them inline, you can colorâ€‘code the input/output counts in your fold text. This makes disconnected nodes immediately visible when scanning folded Nuke scripts in Vim.
</p>

<div id="Vertical Indication"><h1 id="Vertical Indication" class="header"><a href="#Vertical Indication">Vertical Indication</a></h1></div>

<p>
Letâ€™s add indentation guides so nested folds visually show their depth. In Vim, you canâ€™t literally draw vertical bars in the fold gutter, but you can prepend characters to the fold text based on the foldâ€™s nesting level. That way, deeper folds show more bars or arrows, giving you a clear hierarchy.
</p>

<div id="Vertical Indication-ğŸ” Step 1: Compute fold level"><h2 id="ğŸ” Step 1: Compute fold level" class="header"><a href="#Vertical Indication-ğŸ” Step 1: Compute fold level">ğŸ” Step 1: Compute fold level</a></h2></div>

<p>
Vim exposes foldlevel(v:foldstart) which tells you how deep the fold is. We can use that to generate indentation markers.
</p>

<div id="Vertical Indication-ğŸ” Step 1: Compute fold level-ğŸ› ï¸ Updated Foldtext Function"><h3 id="ğŸ› ï¸ Updated Foldtext Function" class="header"><a href="#Vertical Indication-ğŸ” Step 1: Compute fold level-ğŸ› ï¸ Updated Foldtext Function">ğŸ› ï¸ Updated Foldtext Function</a></h3></div>

<pre vim>
function! NukeFoldText()
  let lnum = v:foldstart
  let line = getline(lnum)

  " Extract node name
  let node = matchstr(line, '^\w\+')

  " Default icon
  let icon = 'âš™ï¸'
  if node =~? 'Read'
    let icon = 'ğŸ“¥'
  elseif node =~? 'Write'
    let icon = 'ğŸ“¤'
  elseif node =~? 'Shuffle'
    let icon = 'ğŸ”€'
  elseif node =~? 'Transform'
    let icon = 'ğŸ”§'
  elseif node =~? 'Remove'
    let icon = 'âŒ'
  elseif node =~? 'Merge'
    let icon = 'ğŸ§©'
  endif

  " Detect inputs/outputs
  let inputs = 0
  let outputs = 0
  for i in range(v:foldstart, v:foldend)
    let l = getline(i)
    if l =~? '^inputs'
      let inputs = str2nr(matchstr(l, '\d\+'))
    elseif l =~? '^outputs'
      let outputs = str2nr(matchstr(l, '\d\+'))
    endif
  endfor

  " Color coding for I/O
  let inGroup  = (inputs  &gt; 0 ? '%#NukeFoldGood#' : '%#NukeFoldBad#')
  let outGroup = (outputs &gt; 0 ? '%#NukeFoldGood#' : '%#NukeFoldBad#')

  " Indentation guides based on fold level
  let level = foldlevel(v:foldstart)
  let indent = repeat('â”‚ ', level - 1)

  " Build fold text
  return printf('%s%s %s%s%s (in:%s%d%s out:%s%d%s) â€¦ %d lines',
        \ indent,
        \ icon,
        \ '%#NukeFoldNode#', node, '%#Folded#',
        \ inGroup, inputs, '%#Folded#',
        \ outGroup, outputs, '%#Folded#',
        \ (v:foldend - v:foldstart + 1))
endfunction

setlocal foldtext=NukeFoldText()
</pre>

<div id="Vertical Indication-ğŸ” Step 1: Compute fold level-âœ… Example Result"><h3 id="âœ… Example Result" class="header"><a href="#Vertical Indication-ğŸ” Step 1: Compute fold level-âœ… Example Result">âœ… Example Result</a></h3></div>

<p>
For nested blocks, youâ€™ll see:
</p>

<pre>
ğŸ“¥ Read (in:0 out:1) â€¦ 12 lines
â”‚ ğŸ“¤ Write (in:1 out:0) â€¦ 8 lines
â”‚ â”‚ ğŸ”€ Shuffle (in:2 out:1) â€¦ 15 lines
</pre>

<ul>
<li>
Each deeper fold adds a vertical bar â”‚ as an indentation guide.

<li>
Icons and color coding remain intact.

<li>
The hierarchy of nodes is visually clear.

</ul>
<div id="Vertical Indication-ğŸ” Step 1: Compute fold level-âš¡ Summary"><h3 id="âš¡ Summary" class="header"><a href="#Vertical Indication-ğŸ” Step 1: Compute fold level-âš¡ Summary">âš¡ Summary</a></h3></div>

<p>
By using foldlevel(v:foldstart) and repeat('â”‚ ', level-1), you can prepend indentation guides to fold text. Combined with icons and colorâ€‘coded I/O counts, this gives you a treeâ€‘like view of your Nuke .nk scripts inside Vim.
</p>


<div id="Automatically Collapse"><h1 id="Automatically Collapse" class="header"><a href="#Automatically Collapse">Automatically Collapse</a></h1></div>

<p>
Letâ€™s make Vim automatically collapse all folds into a tree view when you open a .nk file. That way you start with a clean overview of your Nuke script, and can expand only the blocks you want to inspect.
</p>

<div id="Automatically Collapse-ğŸ” Step 1: Autoâ€‘collapse folds on file open"><h2 id="ğŸ” Step 1: Autoâ€‘collapse folds on file open" class="header"><a href="#Automatically Collapse-ğŸ” Step 1: Autoâ€‘collapse folds on file open">ğŸ” Step 1: Autoâ€‘collapse folds on file open</a></h2></div>

<p>
In your ~/.vim/ftplugin/nuke.vim, add:
</p>

<pre vim>
" Enable folding by braces
setlocal foldmethod=marker
setlocal foldmarker={,}
setlocal foldenable

" Custom foldtext (from earlier steps)
setlocal foldtext=NukeFoldText()

" Collapse all folds when opening a .nk file
autocmd BufReadPost *.nk normal! zM
</pre>

<ul>
<li>
zM closes all folds to the maximum level (everything collapsed).

<li>
This runs automatically after you open a .nk file.

</ul>
<div id="Automatically Collapse-ğŸ” Step 2: Optional â€” open only topâ€‘level folds"><h2 id="ğŸ” Step 2: Optional â€” open only topâ€‘level folds" class="header"><a href="#Automatically Collapse-ğŸ” Step 2: Optional â€” open only topâ€‘level folds">ğŸ” Step 2: Optional â€” open only topâ€‘level folds</a></h2></div>

<p>
If you prefer to collapse everything but leave topâ€‘level blocks open, use:
</p>

<pre vim>
autocmd BufReadPost *.nk normal! zR | normal! zM | normal! zO
</pre>

<p>
Explanation:
</p>

<ul>
<li>
zR opens all folds.

<li>
zM closes them all.

<li>
zO opens just the fold under the cursor (usually the first topâ€‘level block). You can adjust this sequence to fit your preferred â€œtree viewâ€ style.

</ul>
<div id="Automatically Collapse-ğŸ” Step 2: Optional â€” open only topâ€‘level folds-âœ… Result"><h3 id="âœ… Result" class="header"><a href="#Automatically Collapse-ğŸ” Step 2: Optional â€” open only topâ€‘level folds-âœ… Result">âœ… Result</a></h3></div>

<p>
When you open a Nuke .nk file:
</p>

<ul>
<li>
All node blocks are folded into a compact tree.

<li>
Fold text shows icons, node names, I/O counts, and indentation guides.

<li>
You can expand with zo or collapse again with zc.

</ul>
<div id="Automatically Collapse-âš¡ Summary:"><h2 id="âš¡ Summary:" class="header"><a href="#Automatically Collapse-âš¡ Summary:">âš¡ Summary:</a></h2></div>

<p>
Add an autocmd BufReadPost *.nk normal! zM to your ftplugin/nuke.vim. This collapses all folds automatically when opening a Nuke script, giving you a clean tree view right away.
</p>

<div id="Toggle Switch"><h1 id="Toggle Switch" class="header"><a href="#Toggle Switch">Toggle Switch</a></h1></div>

<p>
Letâ€™s add a toggle keybinding so you can quickly switch between a collapsed â€œtree viewâ€ and a fully expanded view of your Nuke .nk folds. Vim makes this easy with a custom mapping.
</p>

<div id="Toggle Switch-ğŸ” Step 1: Define a toggle function"><h2 id="ğŸ” Step 1: Define a toggle function" class="header"><a href="#Toggle Switch-ğŸ” Step 1: Define a toggle function">ğŸ” Step 1: Define a toggle function</a></h2></div>

<p>
Add this to your ~/.vim/ftplugin/nuke.vim:
</p>

<pre vim>
function! ToggleTreeView()
  " Check if folds are currently mostly closed
  if foldclosed(1) != -1
    " If closed, open all folds
    normal! zR
  else
    " If open, close all folds
    normal! zM
  endif
endfunction
</pre>

<ul>
<li>
<code>foldclosed(1)</code> checks if the first line is folded.

<li>
If it is, we assume youâ€™re in â€œtree viewâ€ and expand everything (zR).

<li>
If not, we collapse everything (zM).

</ul>
<div id="Toggle Switch-ğŸ” Step 2: Bind it to a key"><h2 id="ğŸ” Step 2: Bind it to a key" class="header"><a href="#Toggle Switch-ğŸ” Step 2: Bind it to a key">ğŸ” Step 2: Bind it to a key</a></h2></div>

<p>
Pick a convenient key â€” for example &lt;leader&gt;t:
</p>

<pre vim>
nnoremap &lt;leader&gt;t :call ToggleTreeView()&lt;CR&gt;
</pre>

<p>
Now pressing &lt;leader&gt;t toggles between collapsed and expanded views.
</p>

<div id="Toggle Switch-ğŸ” Step 2: Bind it to a key-âœ… Example Workflow"><h3 id="âœ… Example Workflow" class="header"><a href="#Toggle Switch-ğŸ” Step 2: Bind it to a key-âœ… Example Workflow">âœ… Example Workflow</a></h3></div>

<ul>
<li>
Open a .nk file â†’ folds autoâ€‘collapse into tree view.

<li>
Press &lt;leader&gt;t â†’ all folds expand.

<li>
Press &lt;leader&gt;t again â†’ everything collapses back into tree view.

</ul>
<div id="Toggle Switch-ğŸ” Step 2: Bind it to a key-âš¡ Summary"><h3 id="âš¡ Summary" class="header"><a href="#Toggle Switch-ğŸ” Step 2: Bind it to a key-âš¡ Summary">âš¡ Summary</a></h3></div>

<p>
By defining a ToggleTreeView() function and mapping it to &lt;leader&gt;t, you can instantly switch between collapsed and expanded fold views while editing Nuke scripts in Vim. This gives you a clean overview and quick access to details without manual zM/zR keystrokes.
</p>


<p>
<a href="vim_learning.html">Vim Learning</a>
</p>

<p>
<a href="index.html">index</a>
</p>

</body>
</html>
