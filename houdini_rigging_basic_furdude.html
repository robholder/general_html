<!DOCTYPE html>
<html>
<head>
<link rel="Stylesheet" type="text/css" href="style.css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<title>houdini_rigging_basic_furdude</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<p>
<a href="index.html">index</a>
</p>

<p>
<a href="Houdini.html">Houdini</a>
</p>

<div id="Basic Rigging"><h1 id="Basic Rigging" class="header"><a href="#Basic Rigging">Basic Rigging</a></h1></div>
<div id="Basic Rigging-[[https://www.sidefx.com/tutorials/foundations-rig-fur-dude-with-kinefx/|Link: SideFX Tutorials - Fur Dude]]"><h4 id="[[https://www.sidefx.com/tutorials/foundations-rig-fur-dude-with-kinefx/|Link: SideFX Tutorials - Fur Dude]]" class="header"><a href="#Basic Rigging-[[https://www.sidefx.com/tutorials/foundations-rig-fur-dude-with-kinefx/|Link: SideFX Tutorials - Fur Dude]]"><a href="https://www.sidefx.com/tutorials/foundations-rig-fur-dude-with-kinefx/">Link: SideFX Tutorials - Fur Dude</a></a></h4></div>
<ul>
<li>
<a href="https://media.sidefx.com/files/tutorials/foundations-rig-fur-dude-with-kinefx/hfoundations_07_kinefx_furdude.pdf">Download PDF</a>

<li>
<a href="https://media.sidefx.com/files/tutorials/foundations-rig-fur-dude-with-kinefx/fur_dude_start.zip">Download Files</a>

</ul>
<div id="Introduction"><h1 id="Introduction" class="header"><a href="#Introduction">Introduction</a></h1></div>
<div id="Introduction-[[https://www.sidefx.com/tutorials/foundations-rig-fur-dude-with-kinefx/|Link: Introduction]]"><h4 id="[[https://www.sidefx.com/tutorials/foundations-rig-fur-dude-with-kinefx/|Link: Introduction]]" class="header"><a href="#Introduction-[[https://www.sidefx.com/tutorials/foundations-rig-fur-dude-with-kinefx/|Link: Introduction]]"><a href="https://www.sidefx.com/tutorials/foundations-rig-fur-dude-with-kinefx/">Link: Introduction</a></a></h4></div>

<p>
In the next chapters the tutorial covers the following - open the FurDude start file and:
</p>
<ol>
<li>
Drawing a skeleton

<li>
Capture the Geometry using biharmonic method

<li>
Add more bones to the skeleton

<li>
Re-orient joints

<li>
Attach capture geometry

<li>
Paint capture weights with brushwork

<li>
Capture the rigid geometry (eyes, teeth) as packed geometry

<li>
Create capture rig Digital Asset

<li>
Create the Animation Rig Asset

<li>
Add more 'control' joints

<li>
Add the main controls

<li>
Add Inverse Kinematics for the legs

<li>
Create a Reverse Foot setup

<li>
Promote the Leg and Spine Controls

<li>
Eye controls

<li>
Animate the Rig

<li>
Add &amp; Groom the fur

<li>
Set up and Render the shot

</ol>
<div id="1 Drawing the Skeleton"><h1 id="1 Drawing the Skeleton" class="header"><a href="#1 Drawing the Skeleton">1 Drawing the Skeleton</a></h1></div>

<p>
Start in the supplied file and jump into the 'fur_dude' geometry container (Network Editor).
</p>

<p>
Switch to Wireframe. (<code>W</code> key.)
</p>

<p>
Use the <code>&lt;space&gt; B</code> shortcut to move between 4 views and the individual views in the Viewport. (It's a toggle to the view under the mouse.)
</p>

<div id="1 Drawing the Skeleton-Creating The Body Skeleton"><h2 id="Creating The Body Skeleton" class="header"><a href="#1 Drawing the Skeleton-Creating The Body Skeleton">Creating The Body Skeleton</a></h2></div>

<ul>
<li>
Go to the <code>right</code> view

<li>
Create a <code>Skeleton</code> node:

<ul>
<li>
Do not connect this node to the 'Load file' node.

<li>
Set 'Skeleton' node's display flags (and set the File import to 'template')

<li>
Hit <code>&lt;enter&gt;</code> in the Viewport while the Skeleton node is selected to evoke the controls

<li>
Mode to Create

<li>
Joint Placement to Freehand

<li>
<code>MMB</code> to end the drawing of joints

</ul>
<li>
Place 7 joints from the hip to the head, just above the center of the eye height (but ending half way between the edge of the eye and the head).

<li>
Enter 'Tweak' mode to adjust:

<li>
Set to <code>Modify</code> rather than 'Create' (I had to use the <code>F</code> key to achieve this properly; the drop down keeps switching back)

<ul>
<li>
Switch on <code>Child Compensation</code> to be able to move them all independently

<li>
For precise editing <code>P</code> for the parameter floating window:

<ul>
<li>
Auto Aline Parent to Child was causing me problems

<li>
You can enter precise values - I entered zero on x for example. 

</ul>
</ul>
<li>
You can enter names for the joints in this Viewport view (top bar):

<ul>
<li>
Select joint, and enter name in field on the top bar

</ul>
<li>
You can also rename using the <code>Rig Tree</code> panel.

</ul>
<p>
Rename the joints to:
</p>
<ul>
<li>
COG

<li>
spine1

<li>
spine2

<li>
spine3

<li>
neck1

<li>
neck2

<li>
head

</ul>
<div id="1 Drawing the Skeleton-Creating a Leg Skeleton"><h2 id="Creating a Leg Skeleton" class="header"><a href="#1 Drawing the Skeleton-Creating a Leg Skeleton">Creating a Leg Skeleton</a></h2></div>

<p>
Switch the Skeleton options to 'Create' mode
</p>
<ul>
<li>
<code>MMB</code> to prevent the bones from starting again at the head joint

<li>
Click on the hip joint to start a chain from there:

<ul>
<li>
<code>&lt;space&gt; B</code> move over the Front view, and <code>&lt;space&gt; B</code> to choose it

<li>
Draw a little below the COG

<li>
Draw a hip

<li>
knee

<li>
ankle

<li>
ball of foot (but back a bit)

<li>
toe

</ul>
</ul>
<p>
This will make 6 joints (the first click on the hip counts)
</p>

<p>
Rename as:
</p>
<ul>
<li>
pelvis

<li>
l_hip

<li>
l_knee

<li>
l_ankle

<li>
l_ball

<li>
l_toe

</ul>
<p>
Take a look in the Perspective view (<code>&lt;space&gt; B</code> etc.)
</p>

<div id="1 Drawing the Skeleton-Mirroring the Leg"><h2 id="Mirroring the Leg" class="header"><a href="#1 Drawing the Skeleton-Mirroring the Leg">Mirroring the Leg</a></h2></div>

<p>
Drop a <code>Skeleton Mirror</code> node.
</p>
<ul>
<li>
Tab and select Skeleton Mirror (in the Viewport!)

<li>
On the <code>Skeleton Mirror</code> parameters pane, click the picker arrow next to the Group field:

<ul>
<li>
Select the joints from the hip to the toe (not the pelvis)

<li>
Hit <code>&lt;enter&gt;</code> to evoke the mirroring.

</ul>
<li>
This action will list the selected joints in the 'Groups' field.

<li>
In the <code>Naming</code> section of the <code>Skeleton Mirror</code> node:

<ul>
<li>
Token Position to <code>start</code>

<li>
Find Tokens field to <code>l_</code>

<li>
Replace Tokens field to <code>r_</code>

<li>
(You can do this AFTER hitting return - it just updates the Group list.

</ul>
<li>
The <code>Rig Tree</code> might show the new mirrored leg collapsed - open the hierarchy to see the new 'r_' items.

</ul>
<div id="2 Capture the Geometry"><h1 id="2 Capture the Geometry" class="header"><a href="#2 Capture the Geometry">2 Capture the Geometry</a></h1></div>

<p>
The next step is to capture the geometry with the bones (with their influence).
</p>

<p>
Drop a <code>Joint Capture Biharmonic</code> node:
</p>
<ul>
<li>
Connect the <code>Load File</code> geometry node to input 1

<li>
Connect the <code>Skeleton Mirror</code> to both input 2 &amp; input 3

</ul>
<p>
Set the display flag to the capture node:
</p>
<ul>
<li>
You'll see a mesh to the side of the actual mesh

<li>
Colored influence visualization on the original mesh (weights).

</ul>
<p>
Next, drop a <code>Bone Deform</code> node.
</p>
<ul>
<li>
If you <code>&lt;shift&gt; enter</code> as you choose the <code>Bone Deform</code>, all three connections will form.

<li>
Alternatively, if it's dropped without connections:

<ul>
<li>
<code>&lt;shift&gt; LMB</code> on each output of the <code>Joint Capture Biharmonic</code> node

<li>
connect to the first input on the <code>Bone Deform</code>

<li>
And all three should connect up to the respective inputs.

</ul>
</ul>
<p>
Between the 3rd output of the <code>Joint Capture Biharmonic</code> node and the 3rd input of the <code>Bone Deform</code>:
</p>
<ul>
<li>
drop a <code>Rig Pose</code> node:

<ul>
<li>
This can be used to test out the joints and see the effect from their movement.

<li>
Just select a joint in the Viewport and transform a bit to test.

</ul>
</ul>
<div id="3 Add More Bones"><h1 id="3 Add More Bones" class="header"><a href="#3 Add More Bones">3 Add More Bones</a></h1></div>

<p>
This part of the tutorial is to illustrate how you can add to a skeleton by editing back at the <code>Skeleton</code> node.
</p>

<p>
Make the <code>Load File</code> node a template again, and set the display flag <code>R</code> on the <code>Skeleton</code> node.
</p>

<p>
Set the skeleton tool to:
</p>
<ul>
<li>
Mode: <code>Create</code>

<li>
Joint Placement: <code>Freehand</code>

</ul>
<div id="3 Add More Bones-Add A Mouth Bone Chain"><h2 id="Add A Mouth Bone Chain" class="header"><a href="#3 Add More Bones-Add A Mouth Bone Chain">Add A Mouth Bone Chain</a></h2></div>

<p>
Click on the <code>neck1</code> node to start, and add two more joints along the lower lip of the character. A third <code>MMB</code> click to end. 
</p>

<ul>
<li>
Mode: <code>Modify</code> (I found I had to do this with the <code>f</code> key and not the dropdown which wouldn't work)

<li>
<code>Child Compensate</code> to 'on'

<li>
And <code>Tweak</code> to 'on' (<code>g</code> key)

</ul>
<p>
You can also rename these joints:
</p>
<ul>
<li>
First to <code>jaw</code>

<li>
Second to <code>lower_mouth</code>

</ul>
<p>
Back at the <code>Bone Deform</code>, you can adjust the new bones to see the affect. (The capture and weighting has already been calculated as the stream passes through the other nodes.)
</p>

<div id="3 Add More Bones-Add The Eye Bone"><h2 id="Add The Eye Bone" class="header"><a href="#3 Add More Bones-Add The Eye Bone">Add The Eye Bone</a></h2></div>

<p>
Back at the <code>Skeleton</code>, same set up as the mouth bones.
</p>

<ul>
<li>
Create mode, and draw by clicking on the <code>head</code> joint, and dropping a second in the center of the eye-ball.

<li>
Do this again, to create another bone which terminates slightly above the first

<li>
Again, to create on slightly below the first.

</ul>
<p>
The result should be three bones emanating from the <code>head</code> joint to the eye.
</p>

<p>
These should be named (from the top):
</p>
<ul>
<li>
upper_lid

<li>
eyeball

<li>
lower_lid

</ul>
<p>
All three of these end joints should be in the exact same location - the center of the eye-ball mesh.
</p>

<p>
These don't function yet (in any practical way), but we'll rig theses later.
</p>

<div id="4 Joint Orientations"><h1 id="4 Joint Orientations" class="header"><a href="#4 Joint Orientations">4 Joint Orientations</a></h1></div>

<p>
The orientation of each joint has been set by the way the joints were drawn, but we can adjust the orientation as needed.
</p>

<p>
To rotate the little gnomons:
</p>
<ul>
<li>
<code>Child Compensation</code> to 'on' (this allows us to rotate the joints without influencing the skeleton layout).

<li>
<code>Mode</code> to <code>Modify</code> ('f' key)

<li>
<code>Tweak Mode</code> to 'on' ('g' key)

</ul>
<p>
In the tutorial (and it's not explained why) the COG and the pelvis joints are set to point up (y up).
</p>

<p>
Next, the other joints are oriented with an <code>Orient Joints</code> node placed after the <code>Skeleton</code> node (before the <code>Skeleton Mirror</code> node).
</p>
<ul>
<li>
With the picker on the Group field:

<ul>
<li>
Select all the joints, then deselect the COG and pelvis joints

<li>
<code>&lt;enter&gt;</code> to add these to the <code>Orient Group</code> field

<li>
<code>Reference Vector</code> to <code>0, 0, 1</code> (to have them point to a positive <code>z</code> direction)

</ul>
</ul>
<div id="5 Attach Capture Geometry"><h1 id="5 Attach Capture Geometry" class="header"><a href="#5 Attach Capture Geometry">5 Attach Capture Geometry</a></h1></div>

<p>
This section of the tutorial showed how to extract curves from the edges of the lip geometry (upper and lower) and use these extracted curves to act as aids to capture the geometry to the bones assigned to the new curves.
</p>

<p>
The end product is that the upper lip curve pulls the upper lip geo up with the head bone, and the lower lip curve allows the bottom lip to open with the mouth bone. There is no blend in the weights - the curves direct the weights accurately and separately.
</p>

<div id="5 Attach Capture Geometry-Split Node"><h2 id="Split Node" class="header"><a href="#5 Attach Capture Geometry-Split Node">Split Node</a></h2></div>

<p>
We need to extract the eye and the tongue from the main geo.
</p>

<ul>
<li>
Drop a <code>Split</code> node immediately after the <code>File</code> node:

<ul>
<li>
In the Group field dropdown choose:

<ul>
<li>
<code>fur_dude_body</code>

<li>
<code>fur_dude_tongue</code>

</ul>
</ul>
<li>
Add a <code>Visibility</code> node:

<ul>
<li>
In the Group field dropdown choose:

<ul>
<li>
<code>fur_dude_tongue</code> 

<li>
This hides the tongue, but doesn't change the geometry.

<li>
The tongue can be brought back later.

</ul>
</ul>
</ul>
<div id="5 Attach Capture Geometry-Extracting Curves from Edges"><h2 id="Extracting Curves from Edges" class="header"><a href="#5 Attach Capture Geometry-Extracting Curves from Edges">Extracting Curves from Edges</a></h2></div>

<p>
With the <code>Select</code> tool, choose the edge selection mode:
</p>
<ul>
<li>
Select the last edge of a polygon on the front of the bottom lip.

<li>
<code>A</code> key while clicking the opposite edge (same edge symmetrically).

<ul>
<li>
The <code>A</code> key should allow you to select the section around the lip.

</ul>
<li>
Drop a <code>Curve From Edges</code> node (tab in the Viewport):

<ul>
<li>
Rename to <code>lower_lip</code>

<li>
This node should be forking out of the <code>Visibility</code> node, and not in the chain.

</ul>
<li>
Repeat this with the top lip:

<ul>
<li>
Select the edge along the top lip as it passes into the mouth cavity.

<li>
Again, edge at the 'corner' of the mouth, <code>A</code> key and select symmetrically.

</ul>
<li>
Drop another <code>Curve from Edges</code> node:

<ul>
<li>
Rename to <code>upper_lip</code>

<li>
Again, fork this node from the <code>Visibility</code> node.

</ul>
</ul>
<p>
The <code>Visibility</code> node should now have three lines coming out:
</p>
<ul>
<li>
To the <code>Joint Capture Biharmonic</code> node

<li>
The <code>lower_lip</code> node

<li>
The <code>upper_lip</code> node

</ul>
<div id="5 Attach Capture Geometry-Merge Packed"><h2 id="Merge Packed" class="header"><a href="#5 Attach Capture Geometry-Merge Packed">Merge Packed</a></h2></div>

<p>
Next we need to drop a <code>Merge Packed</code> node:
</p>
<ul>
<li>
Attach <code>lower_lip</code> into the first input

<li>
Attach <code>upper_lip</code> into the second input

</ul>
<p>
This node will 'pack' each input's geometry first, then merge the inputs.
</p>

<p>
The output from the <code>Merged Packed</code> needs to be plugged into the second (middle) input on the <code>Joint Capture Biharmonic</code> node (but we'll add one more node in the very next step).
</p>

<p>
Add an <code>Attach Joint Geo</code>:
</p>
<ul>
<li>
<code>Skeleton Mirror</code> into input 1

<li>
<code>Merge Packed</code> into input 2

</ul>
<p>
In the parameter panel of the <code>Attach Joint Geo</code> we can assign these 'helper' curves to their specific bones:
</p>
<ul>
<li>
<code>Assign Shapes</code> to 2:

<ul>
<li>
First:

<ul>
<li>
<code>Group</code> to <code>@name=lower_mouth</code> (this is the bone)

<li>
<code>Shape Name</code> to <code>lower_lip</code> (this is the new curve)

<li>
<code>Keep Shape World Transform</code> to 'on'

</ul>
<li>
Second:

<ul>
<li>
<code>Group</code> to <code>@name=neck2</code>  (this is the bone)

<li>
<code>Shape Name</code> to <code>upper_lip</code> (this is the new curve)

<li>
<code>Keep Shape World Transform</code> to 'on'

</ul>
</ul>
</ul>
<p>
Plug the output of the <code>Attach Capture Geo</code> node to the second (middle) input on the <code>Joint Capture Biharmonic</code> node again.
</p>


<div id="5 Attach Capture Geometry-Clear - Rig Pose"><h2 id="Clear - Rig Pose" class="header"><a href="#5 Attach Capture Geometry-Clear - Rig Pose">Clear - Rig Pose</a></h2></div>

<p>
In the tutorial, the instructor 'clears' (a <code>Clear</code> button at the very top of the parameters pane) all the changes on the <code>Rig Pose</code> node
</p>

<div id="6 Paint Capture Weights"><h1 id="6 Paint Capture Weights" class="header"><a href="#6 Paint Capture Weights">6 Paint Capture Weights</a></h1></div>

<p>
Add a <code>Joint Capture Paint</code> node immediately before the <code>Bone Deform</code> node (and it plumbs into all three of the connection lines).
</p>

<p>
Set the Display Flag on the node, and it <code>&lt;enter&gt;</code> in the Viewport.
</p>

<table>
<tr>
<td>
The onscreen HUD (help hints) can be hidden with <span id="6 Paint Capture Weights-<em>'&lt;shift&gt; F1'</em>"></span><strong id="<em>'&lt;shift&gt; F1'</em>"><em>'&lt;shift&gt; F1'</em></strong>.
</td>
</tr>
</table>

<ul>
<li>
Pick a <code>Target Joint</code> from the dropdown to the right of the field:

<ul>
<li>
<code>neck2</code>:

<ul>
<li>
Paint the whole head area from the top lip upwards.

<li>
<code>&lt;scroll wheel&gt;</code> to adjust radius of brush

</ul>
</ul>
<li>
<code>F</code> key to get the paint radial menu:

<ul>
<li>
Choose <code>Smooth</code>

<li>
Paint the transition areas below the head

<li>
Other options are <code>Subtract</code>, <code>Add</code>, <code>Fill</code>, <code>Smudge</code> and more.

</ul>
<li>
You can choose to <code>Display Deformed Geometry</code> or not on the top bar of the Viewport with this tool.

<li>
There are other options like color, show joints, display target joint etc.

</ul>
<p>
You can do all the joint painting on this node - you just choose a different joint in the dropdown, and paint. It stores all the changes for each joint.
</p>

<p>
Set to <code>jaw</code> and <code>Subtract</code> the influence on the 'belly' area.
</p>

<p>
Set to <code>lower_mouth</code> and <code>Add</code> to get the lip to be influenced heavily by the bone. Use <code>Smooth</code> to neaten the resulting map.
</p>


<div id="6 Paint Capture Weights-Toes"><h2 id="Toes" class="header"><a href="#6 Paint Capture Weights-Toes">Toes</a></h2></div>

<p>
Using the same techniques, choose the <code>l_toe</code> (and later the <code>r_toe</code>), and paint the influence on the toe part of the feet.
</p>

<div id="6 Paint Capture Weights-Tongue"><h2 id="Tongue" class="header"><a href="#6 Paint Capture Weights-Tongue">Tongue</a></h2></div>

<p>
Go back up to the <code>Visibility</code> node:
</p>
<ul>
<li>
<code>Action</code> still on <code>Hide Primitives</code>

<li>
<code>Apply to</code> to <code>Non-Selected Primitives</code> (the opposite is <code>Selected Primitives</code>)

</ul>
<p>
Back on the <code>Joint Capture Paint</code> node:
</p>
<ul>
<li>
Set the <code>Target Joint</code> to <code>jaw</code>:

<ul>
<li>
Paint the tongue to get the end completely influenced by the <code>jaw</code> bone.

</ul>
</ul>
<p>
When done, you can <code>Bypass</code> the <code>Visibility</code> node, so that all geo is visible again.
</p>

<div id="7 Capturing The Rigid Geometry"><h1 id="7 Capturing The Rigid Geometry" class="header"><a href="#7 Capturing The Rigid Geometry">7 Capturing The Rigid Geometry</a></h1></div>

<p>
This part of the tutorial covers capturing the rigid geometry (teeth, claws, gums, eye and eyelids).
</p>

<p>
First, we need to 'name' the parts.
</p>
<ul>
<li>
Go to the <code>File</code> node at the top:

<ul>
<li>
Drop a <code>Name</code> node to name the parts:

<ul>
<li>
<code>Attribute</code> to <code>name</code>

<li>
Check <code>Name from Group</code>

<li>
<code>Group Mask</code> to <code>*</code>

</ul>
</ul>
</ul>
<p>
After the <code>Split</code> node:
</p>
<ul>
<li>
Drop a <code>Pack</code> node:

<ul>
<li>
Switch on the <code>Name Attribute</code> and enter <code>name</code>

<li>
<code>Transfer Attributes</code> to <code>name</code>

</ul>
</ul>
<p>
The <code>Pack</code> node has 'packed' each name (group) into a primitive. If you look at the <code>Geometry Spreadsheet</code> you see just one entry for each of the <code>name</code> primitives after the <code>Pack</code> node.
</p>

<p>
Next we drop a <code>Capture Packed Geometry</code> node.
</p>
<ul>
<li>
Plug the <code>Pack</code> node's output into input 1

<li>
Plug the <code>Skeleton Mirror</code> node into input 2

</ul>
<p>
In the <code>Capture Packed Geometry</code> node's parameters, choose the Manual Capture 1 section:
</p>
<ul>
<li>
From the dropdown:

<ul>
<li>
<code>Capture Geo</code> to <code>@name=fur_dude_lowteeth</code>

<li>
<code>Joint</code> to <code>@name=lower_mouth</code>

</ul>
</ul>
<p>
The '@name=' part of the expression is automatically added with the dropdown selection.
</p>

<p>
Use the <code>+</code> button to add more <code>Manual Capture</code> specifications.
</p>

<p>
You can add multiple rigid geometry items in one group if they have the same bone to influence them:
</p>
<ul>
<li>
<code>Capture Geo</code> to <code>@name=fur_dude_gums @name=fur_dude_upteeth</code>

<li>
<code>Joint</code> to <code>@name=neck2</code>

<li>
<code>+</code>

<li>
<code>Capture Geo</code> to <code>@name=fur_dude_rclaws</code>

<li>
<code>Joint</code> to <code>@name=fur_dude_r_toe</code>

<li>
<code>+</code>

<li>
<code>Capture Geo</code> to <code>@name=fur_dude_lclaws</code>

<li>
<code>Joint</code> to <code>@name=fur_dude_l_toe</code>

<li>
<code>+</code>

<li>
<code>Capture Geo</code> to <code>@name=fur_dude_eye</code>

<li>
<code>Joint</code> to <code>@name=eyeball</code>

<li>
<code>+</code>

<li>
<code>Capture Geo</code> to <code>@name=fur_dude_uplid</code>

<li>
<code>Joint</code> to <code>@name=upper_lid</code>

<li>
<code>+</code>

<li>
<code>Capture Geo</code> to <code>@name=fur_dude_lowlid</code>

<li>
<code>Joint</code> to <code>@name=lower_lid</code>

</ul>
<p>
If you get a warning that it needs a valid rest transform attribute, uncheck the "Rest Pose Attribute" option under the "Add Shapes" tab.
</p>

<div id="7 Capturing The Rigid Geometry-Testing the Assignments"><h2 id="Testing the Assignments" class="header"><a href="#7 Capturing The Rigid Geometry-Testing the Assignments">Testing the Assignments</a></h2></div>

<p>
You can bypass all the rest of the network and plug the output of the <code>Capture Packed Geometry</code> node directly into the first input of the <code>Bone Deform</code> at the base of the network.
</p>

<p>
In this way, we can rotate the various bones to see if everything moves as we expected.
</p>

<div id="7 Capturing The Rigid Geometry-Combining the Captures"><h2 id="Combining the Captures" class="header"><a href="#7 Capturing The Rigid Geometry-Combining the Captures">Combining the Captures</a></h2></div>

<p>
To restore the rest of the captures with these rigid geometry captures:
</p>
<ul>
<li>
Add a <code>Merge</code> node:

<ul>
<li>
<code>Capture Packed Geometry</code> into input 1

<li>
<code>Joint Capture Paint</code> into input 2

</ul>
</ul>
<p>
The output of the <code>Merge</code> will continue into the first input of the <code>Bone Deform</code> node.
</p>

<div id="7 Capturing The Rigid Geometry-Unpack"><h2 id="Unpack" class="header"><a href="#7 Capturing The Rigid Geometry-Unpack">Unpack</a></h2></div>

<p>
Drop an <code>Unpack</code> node before the <code>Merge</code> for the rigid geometry:
</p>
<ul>
<li>
Set <code>Iterations</code> to 2

<li>
<code>Transfer Attributes</code> to <code>* ^Cd</code>

</ul>
<div id="8 Create Capture Rig Digital Asset"><h1 id="8 Create Capture Rig Digital Asset" class="header"><a href="#8 Create Capture Rig Digital Asset">8 Create Capture Rig Digital Asset</a></h1></div>

<table>
<tr>
<td>
THIS PART IS PROBABLY OUT OF DATE WITH THE NEWER WORKFLOWS (APEX?) WHERE A DIGITAL ASSET IS NOT REQUIRED.
</td>
</tr>
</table>

<div id="8 Create Capture Rig Digital Asset-[[https://www.sidefx.com/docs/houdini/character/kinefx/overview.html|Link: See this article for more information]]"><h4 id="[[https://www.sidefx.com/docs/houdini/character/kinefx/overview.html|Link: See this article for more information]]" class="header"><a href="#8 Create Capture Rig Digital Asset-[[https://www.sidefx.com/docs/houdini/character/kinefx/overview.html|Link: See this article for more information]]"><a href="https://www.sidefx.com/docs/houdini/character/kinefx/overview.html">Link: See this article for more information</a></a></h4></div>

<div id="8 Create Capture Rig Digital Asset-Saving geometry"><h4 id="Saving geometry" class="header"><a href="#8 Create Capture Rig Digital Asset-Saving geometry">Saving geometry</a></h4></div>
<ul>
<li>
Drop a <code>ROP Geometry Output</code> node (forked from the <code>Merge</code> before the <code>Bone Deform</code> node.

<li>
Give the <code>Output File</code> a path/name - <code>$HIP/geo/fur_dude_capt.bgeo.sc</code> in our case:

<ul>
<li>
'capt' for 'capture'

<li>
bgeo is Houdini's geometry format

<li>
sc is a compressed option.

</ul>
<li>
<code>Valid Frame Range</code> to <code>Render Current Frame</code> (we only need one frame).

<li>
<code>Save to Disk</code>

</ul>
<div id="8 Create Capture Rig Digital Asset-Saving the Skeleton"><h4 id="Saving the Skeleton" class="header"><a href="#8 Create Capture Rig Digital Asset-Saving the Skeleton">Saving the Skeleton</a></h4></div>
<ul>
<li>
Go to the end of the skeleton setup:

<ul>
<li>
<code>Skeleton Mirror</code> node

</ul>
<li>
Drop a forked (not in stream) <code>ROP Geometry Output</code> node:

<li>
Give the <code>Output File</code> a path/name - <code>$HIP/geo/fur_dude_skel.bgeo.sc</code> in our case:

<ul>
<li>
'skel' for 'skeleton'

<li>
bgeo is Houdini's geometry format

<li>
sc is a compressed option.

</ul>
<li>
<code>Valid Frame Range</code> to <code>Render Current Frame</code> (we only need one frame).

<li>
<code>Save to Disk</code>

</ul>
<div id="8 Create Capture Rig Digital Asset-Rename and Hide Setup"><h2 id="Rename and Hide Setup" class="header"><a href="#8 Create Capture Rig Digital Asset-Rename and Hide Setup">Rename and Hide Setup</a></h2></div>

<p>
Jump out of the Geometry container, and rename to <code>fur_dude_capture</code>.
</p>

<div id="8 Create Capture Rig Digital Asset-Import the Files"><h2 id="Import the Files" class="header"><a href="#8 Create Capture Rig Digital Asset-Import the Files">Import the Files</a></h2></div>

<ul>
<li>
At the Obj level drop a <code>File</code> (from the <code>Create</code> shelf):

<ul>
<li>
Navigate to the <code>$HIP/geo/fur_dude_capt.bgeo.sc</code> file, and press <code>&lt;enter&gt;</code> in the Viewport.

<li>
It should import as a Geometry container with the name <code>fur_dude_capt.bgeo</code>

<li>
Rename to <code>fur_dude_rig</code>

</ul>
<li>
Jump inside:

<ul>
<li>
Duplicate the <code>File</code> node:

<ul>
<li>
In the <code>Geometry File</code> field, navigate to <code>$HIP/geo/fur_dude_skel.bgeo.sc</code>

<li>
Rename to <code>fur_dude_skel.bgeo</code>

</ul>
</ul>
</ul>
<div id="8 Create Capture Rig Digital Asset-Creating the Digital Asset"><h2 id="Creating the Digital Asset" class="header"><a href="#8 Create Capture Rig Digital Asset-Creating the Digital Asset">Creating the Digital Asset</a></h2></div>

<p>
While still inside the Geometry Container, select both the <code>File</code> nodes we just made:
</p>
<ul>
<li>
<code>Assets &gt; New Digital Asset From Selection</code>:

<ul>
<li>
<code>Operator Name</code> to <code>fur_dude_capture</code>

<li>
<code>Operator Lable</code> - just capitalize to <code>Fur Dude Capture</code>

<li>
<code>Save to Library</code>:

<ul>
<li>
Navigate to the project's <code>hda</code> directory

<li>
Save as <code>$HIP/hda/fur_dude.hda</code>.

<li>
<code>Accept</code>

</ul>
</ul>
<li>
In the dialog or settings panel that appears, set:

<ul>
<li>
<code>Maximum Outputs</code> to <code>3</code>

<li>
<code>Accept</code>

</ul>
<li>
Connect the capt <code>File</code> node to <code>Output</code> and rename <code>CaptureGeo</code>

<li>
Duplicate this <code>Output</code> node <em>TWICE</em>:

<ul>
<li>
Feed the <code>skel</code> <code>File</code> node into <em>BOTH</em>.

<li>
Call the first output <code>RestSkeleton</code>

<li>
the second <code>AnimSkeleton</code>

<li>
Give each <code>Output</code> its own index:

<ul>
<li>
first: <code>Output Index</code> to 1

<li>
second: <code>Output Index</code> to 2

</ul>
</ul>
<li>
Set the Display Flag on the <code>CaptureGeo</code> output.

</ul>
<div id="8 Create Capture Rig Digital Asset-Edit the Asset to 'Self Contain' the Geometry"><h2 id="Edit the Asset to 'Self Contain' the Geometry" class="header"><a href="#8 Create Capture Rig Digital Asset-Edit the Asset to 'Self Contain' the Geometry">Edit the Asset to 'Self Contain' the Geometry</a></h2></div>

<p>
Initially, the state of the asset is that it reads the geometry off disk. We need to include the asset geometry so there is a more convenient encapsulated state.
</p>

<p>
While still in the container, in the Houdini system menu:
</p>
<ul>
<li>
<code>Asset &gt; Edit Asset Properties... &gt; Fur Dude Capture Rig</code>

<li>
On the <code>Extra Files</code> tab:

<ul>
<li>
<code>Add File</code> -&gt; add the <code>capt</code> file

<li>
<code>Add File</code> -&gt; add the <code>skel</code> file

</ul>
<li>
<code>Accept</code>

</ul>
<p>
Now we need to change the <code>File</code> paths to read the stored files and not the files on disk:
</p>
<ul>
<li>
Back to the <code>File</code> nodes:

<ul>
<li>
<code>Geometry File</code> navigate to <code>opdef:/Sop/fur_dude_capt.bgeo.sc</code>

<li>
<code>Geometry File</code> navigate to <code>opdef:/Sop/fur_dude_skel.bgeo.sc</code>

</ul>
</ul>
<p>
Now the HDA will be more portable - we are referencing the stored geo.
</p>

<div id="8 Create Capture Rig Digital Asset-Lock the Asset"><h2 id="Lock the Asset" class="header"><a href="#8 Create Capture Rig Digital Asset-Lock the Asset">Lock the Asset</a></h2></div>

<ul>
<li>
In the Houdini system menu:

<ul>
<li>
<code>Lock Asset &gt; Fur Dude Capture Rig</code>

<li>
<code>Save</code> the changes

</ul>
</ul>
<div id="8 Create Capture Rig Digital Asset-Set up"><h2 id="Set up" class="header"><a href="#8 Create Capture Rig Digital Asset-Set up">Set up</a></h2></div>

<p>
Up at the Obj level:
</p>
<ul>
<li>
Add a <code>Bone Deform</code> to this HDA:

<ul>
<li>
Remember you can <code>&lt;shift&gt; LMB</code> click on the three outputs of the HDA, then click on the first input of the <code>Bone Deform</code>. The connections should connect as three lines.

</ul>
<li>
Add a <code>Rig Pose</code> between the two nodes on the 3rd wire.

</ul>
<div id="9 Create the Animation Rig Asset"><h1 id="9 Create the Animation Rig Asset" class="header"><a href="#9 Create the Animation Rig Asset">9 Create the Animation Rig Asset</a></h1></div>

<p>
Still inside the <code>fur_dude_rig</code>:
</p>
<ul>
<li>
Select the three nodes ('fur_dude_capture_rig', 'bonedeform1', 'rigpose'):

<ul>
<li>
<code>Asset &gt; Create New Digital Asset from Node</code>:

<ul>
<li>
<code>Operator Name</code> to <code>fur_dude_anim_rig</code> 

<li>
<code>Operator Label</code> to <code>Fur Dude Anim Rig</code>

</ul>
</ul>
<li>
<code>Save to Library</code> -&gt; navigate to the <code>hda</code> directory:

<ul>
<li>
Select the <code>fur_dude.hda</code>

<li>
<em>This is weird to me, but you point to the hda we made earlier - and this saves <span id="9 Create the Animation Rig Asset-TO"></span><strong id="TO">TO</strong> it..</em>

</ul>
<li>
<code>Accept</code>

</ul>
<p>
Rename this new container as:
</p>
<ul>
<li>
<code>fur_dude_anim_rig</code>

</ul>
<p>
Move up a level (to the Obj level):
</p>
<ul>
<li>
you should see the <code>fur_dude_capture</code> and the new <code>fur_dude_rig</code> nodes.

</ul>
<div id="9 Create the Animation Rig Asset-Create a Locked Version Of the Rig"><h2 id="Create a Locked Version Of the Rig" class="header"><a href="#9 Create the Animation Rig Asset-Create a Locked Version Of the Rig">Create a Locked Version Of the Rig</a></h2></div>

<p>
Duplicate the <code>fur_dude_anim_rig</code> (<code>&lt;alt&gt; drag</code>):
</p>
<ul>
<li>
Rename to <code>test_rig</code>

<li>
Move it at the outside level to the right (so we can see both versions in the Viewport).

<li>
Jump inside:

<ul>
<li>
Lock this duplicate:

<ul>
<li>
<code>Assets &gt; Lock Asset &gt; Fur Dude Anim Rig</code>

<li>
<code>Save Changes</code>

</ul>
</ul>
</ul>
<div id="9 Create the Animation Rig Asset-Quick Jump"><h2 id="Quick Jump" class="header"><a href="#9 Create the Animation Rig Asset-Quick Jump">Quick Jump</a></h2></div>

<ul>
<li>
In the duplicate hit <code>&lt;cmd&gt; 1</code> to set a Quick Jump mark into the container

<li>
In the original, but down one more level, hit <code>&lt;cmd&gt; 2</code> to set another

</ul>
<div id="9 Create the Animation Rig Asset-Promoting to the Digital Asset"><h2 id="Promoting to the Digital Asset" class="header"><a href="#9 Create the Animation Rig Asset-Promoting to the Digital Asset">Promoting to the Digital Asset</a></h2></div>

<p>
So, we have two assets, both pulling from disk. Changing one will affect the other as a result.
</p>

<p>
While inside the original, at the level where we see the three nodes:
</p>
<ul>
<li>
<code>Assets &gt; Edit Asset Properties... Fur Dude Anim Rig</code>:

<ul>
<li>
<code>Node</code> tab:

<ul>
<li>
Set <code>Default State</code> to <code>kinefx__rigpose</code> (that's a double underscore).

<li>
Apparently this makes the rigpose available in the UI - but I don't know what that means.

</ul>
</ul>
</ul>
<div id="10 Add More Control Joints"><h1 id="10 Add More Control Joints" class="header"><a href="#10 Add More Control Joints">10 Add More Control Joints</a></h1></div>

<p>
The first task described in this lesson is to Jump into the <code>fur_dude_anim_rig</code>:
</p>
<ul>
<li>
Drop a <code>Delete Joints</code> node (forked from the <code>fur_dude_capture_rig</code>)

<ul>
<li>
Select the 'right' side joints of the leg and hit <code>&lt;enter&gt;</code>

<li>
(This will populate the <code>Group</code> field.)

</ul>
<li>
From the <code>Delete Joints</code> node:

<ul>
<li>
Drop a <code>Skeleton</code> node:

<ul>
<li>
Turn on <code>Grid Snap</code> on the icons to the left of the Viewport 

<li>
In the skeleton <code>Create</code> mode, click near the origin, then <code>MMB</code> to end

<li>
This will create a single joint at the origin.

<li>
Name it <code>fur_dude_main</code>

<li>
Turn off the <code>Grid Snap</code>

<li>
<code>RMB</code> on the skeleton and chose to show <code>Display Joint Axes</code>:

<ul>
<li>
Check the new joint is aligned to the world.

</ul>
</ul>
</ul>
</ul>
<div id="10 Add More Control Joints-Creating a Heel"><h2 id="Creating a Heel" class="header"><a href="#10 Add More Control Joints-Creating a Heel">Creating a Heel</a></h2></div>

<p>
In the side view:
</p>
<ul>
<li>
<code>MMB</code> anywhere to start afresh

<li>
<code>LMB</code> click on the toe, click on the back of the heel area, then <code>MMB</code> to end

<li>
<code>Modify</code> mode, and rename:

<ul>
<li>
<code>l_heel</code>

<li>
Hit <code>p</code> to open parameters:

<ul>
<li>
Check <code>Child Compensate</code>

<li>
<code>Rotate</code> to 0, 0, 0

</ul>
</ul>
</ul>
<div id="10 Add More Control Joints-Eye Lids"><h2 id="Eye Lids" class="header"><a href="#10 Add More Control Joints-Eye Lids">Eye Lids</a></h2></div>

<p>
Again in the side view:
</p>
<ul>
<li>
<code>MMB</code> anywhere to start afresh

<li>
<code>LMB</code> click out about a unit from the front of the eye (away from the model geo)

<li>
<code>Modify</code> mode, and rename:

<ul>
<li>
<code>eye_target</code>

<li>
Hit <code>p</code> to open parameters:

<ul>
<li>
Check <code>Child Compensate</code>

<li>
<code>Rotate</code> to 0, 0, 0

</ul>
</ul>
</ul>
<div id="10 Add More Control Joints-Including in the Skeleton"><h2 id="Including in the Skeleton" class="header"><a href="#10 Add More Control Joints-Including in the Skeleton">Including in the Skeleton</a></h2></div>

<p>
After the <code>Skeleton</code> node:
</p>
<ul>
<li>
Drop a <code>Parent Joints</code> node:

<ul>
<li>
Click the <code>Parent</code> <code>+</code> button twice for two entries.

<ul>
<li>
<code>Joint1</code> to <code>@name=COG</code>

<li>
<code>Parent1</code> to <code>@name=fur_dude_main</code>

<ul>
<li>
Now there is a parent/child relationship between the two joints.

</ul>
<li>
<code>Joint2</code> to <code>@name=eye_target</code>

<li>
<code>Parent2</code> to <code>@name= COG</code>

<ul>
<li>
Again, there is a relationship set up. 

</ul>
</ul>
</ul>
</ul>
<div id="10 Add More Control Joints-Mirror"><h2 id="Mirror" class="header"><a href="#10 Add More Control Joints-Mirror">Mirror</a></h2></div>

<p>
After the <code>Parent Joints</code> node, add a <code>Skeleton Mirror</code> node:
</p>
<ul>
<li>
Use the <code>Group</code> select tool and select all the left leg joints

<li>
<code>Naming</code> section:

<ul>
<li>
<code>Start</code>

<ul>
<li>
<code>Find Tokens</code> <code>l_</code>

<li>
<code>Replace Tokens</code> <code>r_</code>

</ul>
</ul>
</ul>
<p>
Feed the output of the <code>Skeleton Mirror</code> node into the <code>rigpose</code> node.
</p>

<p>
In the tutorial, these four new skeleton nodes are surrounded by a network box and labeled <code>Add Joints</code>.
</p>

<p>
Set the <code>Display Flag</code> to the <code>Bone Deform</code>.
</p>

<div id="10 Add More Control Joints-Save the Asset"><h2 id="Save the Asset" class="header"><a href="#10 Add More Control Joints-Save the Asset">Save the Asset</a></h2></div>

<ul>
<li>
<code>Assets &gt; Save Asset &gt; Fur Dude Anim Rig</code>

</ul>
<div id="10 Add More Control Joints-Fixing Toe Flips"><h2 id="Fixing Toe Flips" class="header"><a href="#10 Add More Control Joints-Fixing Toe Flips">Fixing Toe Flips</a></h2></div>

<p>
In the tutorial, the claws are screwed-up. They are upside down.
</p>

<p>
To fix, the tutor:
</p>
<ul>
<li>
Selected the <code>Skeleton</code> node in the <code>fur_dude_anim_rig</code>:

<ul>
<li>
Selected the toe joint.

<li>
<code>P</code> for parameter pane:

<ul>
<li>
<code>Rotation</code> to 0, 0, -90

</ul>
</ul>
</ul>
<p>
The right toes follow suit and get fixed by the mirroring.
</p>

<ul>
<li>
<code>Assets &gt; Save Asset &gt; Fur Dude Anim Rig</code>

</ul>
<div id="11 The Main Controls"><h1 id="11 The Main Controls" class="header"><a href="#11 The Main Controls">11 The Main Controls</a></h1></div>

<p>
The goal here is to create controls for the rig.
</p>

<p>
This will involve working on subsets of joints.
</p>

<ul>
<li>
Fork from the <code>Skeleton Mirror</code> with a <code>Delete Joints</code> node:

<ul>
<li>
In the <code>Group</code> field (choose the picker):

<ul>
<li>
Select the <code>COG</code>, <code>pelvis</code>, <code>l_heel</code>, <code>r_heel</code>, <code>fur_dude_main</code>

<li>
<code>&lt;enter&gt;</code>

<li>
<code>Operation</code> to <code>Delete Non-Selected</code>

</ul>
</ul>
<li>
Drop a <code>Parent Joint</code> node:

<ul>
<li>
<code>Joint1</code> select or enter <code>@name=r_heel @name=l_heel</code>

<li>
<code>Parent</code> to <code>@name=fur_dude_main</code>

</ul>
<li>
Connect the output into the <code>rigpose</code> node (replace the original input)

</ul>
<p>
While looking at the <code>rigpose</code> node (with Display Flag), select all the joints we've been manipulating in the Viewport. Apparently this populates the <code>rigpose</code> panel.
</p>

<div id="11 The Main Controls-Blending The New Joints To The Skeleton"><h2 id="Blending The New Joints To The Skeleton" class="header"><a href="#11 The Main Controls-Blending The New Joints To The Skeleton">Blending The New Joints To The Skeleton</a></h2></div>


<p>
Create a freestanding <code>Skeleton Blend</code> node:
</p>
<ul>
<li>
Fork an output from the <code>Skeleton Mirror</code> node into the input 1

<li>
Fork an output from the <code>rigpose</code> node into the input 2 fo the <code>Skeleton Blend</code>.

<li>
Wire the output from the <code>Skeleton Blend</code> into the <code>Bone Deform</code> (replacing the existing input):

<ul>
<li>
On the <code>Skeleton Blend</code>:

<ul>
<li>
Set <code>World Space</code> to 'on'

<li>
<code>weight1</code> to 1

</ul>
</ul>
<li>
<code>Assets &gt; Save Asset &gt; Fur Dude Anim Rig</code>

</ul>
<div id="11 The Main Controls-Creating Controls"><h2 id="Creating Controls" class="header"><a href="#11 The Main Controls-Creating Controls">Creating Controls</a></h2></div>

<p>
In the <code>fur_dude_anim_rig</code> again:
</p>
<ul>
<li>
Drop a freestanding <code>Circle</code> node:

<ul>
<li>
<code>Primitive Type</code> to <code>Polygon</code>

<li>
<code>Orientation</code> to <code>ZX Plane</code>

<li>
<code>Uniform Scale</code> to 0.2

<li>
<code>Divisions</code> to 36

<li>
<code>Arc Type</code> to <code>Open Arc</code>

</ul>
<li>
Add a <code>Color</code> node:

<ul>
<li>
set to yellow

</ul>
<li>
Add a <code>Merge Packed</code> node:

<ul>
<li>
<code>Name 1</code> to <code>color_ctrl</code>

</ul>
</ul>
<p>
Between the <code>Parent Joint</code> node and the <code>rigpose</code> add an <code>Attach Joint Geo</code> node:
</p>
<ul>
<li>
Plug the <code>Merge Packed</code> node into the input 2

<li>
Select all the joints we see (the ones we've been working on) and press <code>&lt;enter&gt;</code>:

<ul>
<li>
In the <code>Tweak</code> tab of the <code>Attach Joint Geo</code> node, we should see the @name list of all the joints.

</ul>
<li>
On the top bar, switch mode to <code>Assign Shapes</code>

<li>
<code>MMB</code> in any empty space in the Viewport:

<ul>
<li>
Unclear, but <code>G</code> key and <code>&lt;scroll&gt;</code> to get all the joints assigned.

</ul>
<li>
Set back to <code>Tweak</code> mode in the Viewport:

<ul>
<li>
Select the COG and pelvis circles

<li>
<code>G</code>

<li>
<code>E</code> to scale just bigger than the waist.

</ul>
<li>
Select the <code>heel</code> joints:

<ul>
<li>
Same thing to scale these down.

</ul>
</ul>
<p>
Setting the Display Flag on the <code>rigpose</code> node, you should be able to select the circles and see the potential for control.
</p>

<div id="11 The Main Controls-Promoting the Controls"><h2 id="Promoting the Controls" class="header"><a href="#11 The Main Controls-Promoting the Controls">Promoting the Controls</a></h2></div>

<p>
<code>Assets &gt; Edit Asset Properties... &gt; Fur Dude Anim Rig</code>:
</p>
<ul>
<li>
In the parameters panel (not the Edit Operator window):

<li>
For the <code>COG</code>:

<ul>
<li>
Unlock the <code>Translate</code> row 

<li>
Unlock the <code>Scale</code> row 

</ul>
<li>
Check the others are unlocked.

</ul>
<p>
Now lock some:
</p>
<ul>
<li>
<code>fur_dude_main</code>:

<ul>
<li>
Lock the <code>Scale</code>

</ul>
</ul>
<p>
Drag stuff from the parameters to the <code>Edit Operator</code> window:
</p>
<ul>
<li>
Again from the <code>fur_dude_main</code>:

<ul>
<li>
drag <code>Translate</code> onto the <code>root</code>

<li>
drag <code>Rotate</code> onto the <code>root</code>

</ul>
<li>
Adjust the labels in the <code>Edit Operators</code> window:

<ul>
<li>
translate to <code>Main Translate</code>

<li>
rotate to <code>Main Rotate</code>

</ul>
<li>
<code>Accept</code> button

</ul>
<p>
Now if you go to the locked <code>Fur Dude Anim Rig</code>, and click on the <code>main</code> joint node, you should see the two items promoted to the Parameters panel for the <code>Fur Dude Anim Rig</code> node.
</p>

<div id="11 The Main Controls-Continue To Drag More Parameters"><h2 id="Continue To Drag More Parameters" class="header"><a href="#11 The Main Controls-Continue To Drag More Parameters">Continue To Drag More Parameters</a></h2></div>

<p>
Now do the same for more controls:
</p>
<ul>
<li>
<code>COG</code>:

<ul>
<li>
Lock the <code>Scale</code>

<li>
Drag the <code>Translate</code> to the <code>Edit Operator Type Properties</code> window

<li>
Label them <code>COG Translate</code> and <code>COG Rotate</code> respectively.

</ul>
</ul>
<p>
Whatever you promote in this way will become available for the animator.
</p>

<ul>
<li>
<code>pelvis</code>:

<ul>
<li>
Lock the <code>Translate</code>

<li>
Lock the <code>Scale</code>

<li>
Drag the <code>Rotate</code> to the <code>Edit Operator Type Properties</code>

<li>
Label the parameter, <code>Pelvis Rotate</code>

</ul>
<li>
<code>heel</code> (both):

<ul>
<li>
Lock the <code>Scale</code>

<li>
Drag <code>Translate</code> and <code>Rotate</code>

<li>
Label them <code>Left Heel Translate</code>, <code>Left Heel Rotate</code> and then the same for the right.

</ul>
</ul>
<p>
The tutorial then makes a network box called 'Main Controls' to neaten the script.
</p>

<div id="12 Inverse Kinematics For The Legs"><h1 id="12 Inverse Kinematics For The Legs" class="header"><a href="#12 Inverse Kinematics For The Legs">12 Inverse Kinematics For The Legs</a></h1></div>

<p>
From the <code>Skeleton Blend</code>, fork a <code>Delete Joints</code> node:
</p>
<ul>
<li>
Using the Group field's picker:

<ul>
<li>
pick the three leg joints (hip, knee, ankle) of both legs.

<li>
<code>Delete Non-Selected</code>

</ul>
<li>
Add a <code>Parent Joints</code> node:

<ul>
<li>
Select the six joints that make the legs into the <code>Joint1</code> field.

<li>
The <code>Parent1</code> field is left empty.

<li>
This is not adjusted really - not sure why it's here:

<ul>
<li>
UPDATE: I think it un-parents the joints.

</ul>
</ul>
<li>
Add an <code>IK Chains</code> joint:

<ul>
<li>
Join the <code>Skeleton Blend</code> into input 1

<li>
Joint the <code>Parent Joints</code> into input 2

<li>
You can use the picker to add the following:

<ul>
<li>
<code>Root Name</code> to <code>l_hip</code>

<li>
<code>Mid Name</code> to <code>l_knee</code> 

<li>
<code>Tip Name</code> to <code>l_ankle</code>

<li>
<code>Match By Name</code> to 'on'

<li>
<code>Orient Tip</code> to 'on'

</ul>
<li>
Plus key to add another bank:

<ul>
<li>
<code>Root Name</code> to <code>r_hip</code>

<li>
<code>Mid Name</code> to <code>r_knee</code> 

<li>
<code>Tip Name</code> to <code>r_ankle</code>

<li>
<code>Match By Name</code> to 'on'

<li>
<code>Orient Tip</code> to 'on'

</ul>
</ul>
<li>
Before the <code>IK Chains</code> node:

<ul>
<li>
Add a <code>rigpose</code> node:

<ul>
<li>
Rename to <code>rigpose_ankles</code>

<li>
Moving the ankle joints will now work but with some crazy knee flipping.

</ul>
</ul>
<li>
Add a second <code>rigpose</code> node after the first:

<ul>
<li>
Rename to <code>knee_offset</code>

<li>
In the tutorial, the tutor moves the actual knee joints out in front of the legs to act as aim constraints.

</ul>
</ul>
<div id="12 Inverse Kinematics For The Legs-Blend Back To The Original Skeleton"><h2 id="Blend Back To The Original Skeleton" class="header"><a href="#12 Inverse Kinematics For The Legs-Blend Back To The Original Skeleton">Blend Back To The Original Skeleton</a></h2></div>

<p>
Add a <code>Skeleton Blend</code> node:
</p>
<ul>
<li>
Connect the original <code>Skeleton Blend</code> to input 1

<li>
Connect the <code>knee offset</code> to input 2

<li>
Set the Display Flag

<li>
<code>World Space</code> 'on'

<li>
<code>weight</code> to 1

</ul>
<p>
Now connect the output of the <code>Skeleton Blend</code> to the 3rd input of the <code>Bone Deform</code> (to replace the original <code>Skeleton Blend</code>).
</p>

<p>
Set the Display Flag on the <code>output</code> node.
</p>

<div id="13 Reverse Foot Setup"><h1 id="13 Reverse Foot Setup" class="header"><a href="#13 Reverse Foot Setup">13 Reverse Foot Setup</a></h1></div>

<p>
The tutor deletes the existing ankles (to bring them back another way).
</p>

<ul>
<li>
Add a <code>Delete Joint</code> node:

<ul>
<li>
Fork it from the <code>Skeleton Mirror</code> node, way up the chain.

<li>
In the Group field, use the picker to pick the left side's ankle, and all its children.

<ul>
<li>
<code>@name=l_ankle @name=l_ball @name=l_toe @name=l_heel</code>

<li>
<code>Operation</code> to <code>Delete Non Selected</code> 

</ul>
</ul>
<li>
Add a <code>Delete Joints</code> node:

<ul>
<li>
Populate the <code>Joints1</code> field by selecting all the joints that remain (ankle and feet joints)

<li>
Leave the <code>Parent1</code> field empty (this effectively 'un-parents')

</ul>
<li>
Add another <code>Parent Joints</code> node below the first one:

<ul>
<li>
Plus x3 to make three entries:

<ul>
<li>
joint <code>@name=1_toe</code> parent <code>@name=l_heel</code>

<li>
joint <code>@name=l_ball</code> parent <code>l_toe</code>

<li>
joint <code>@name=l_ankle</code> parent <code>l_ball</code>

</ul>
</ul>
</ul>
<div id="13 Reverse Foot Setup-Mirror the Skeleton"><h2 id="Mirror the Skeleton" class="header"><a href="#13 Reverse Foot Setup-Mirror the Skeleton">Mirror the Skeleton</a></h2></div>

<ul>
<li>
Add a <code>Skeleton Mirror</code>, and as usual:

<ul>
<li>
<code>Naming</code>:

<ul>
<li>
<code>Find Tokens</code> to <code>l_</code>

<li>
<code>Replace Tokens</code> to <code>r_</code>

</ul>
</ul>
<li>
Add a <code>rigpose</code> node after the <code>Skeleton Mirror</code>:

<ul>
<li>
Rename to <code>rigpose_foot</code>

</ul>
</ul>
<div id="13 Reverse Foot Setup-Blending Back"><h2 id="Blending Back" class="header"><a href="#13 Reverse Foot Setup-Blending Back">Blending Back</a></h2></div>

<p>
We now have to blend this new setup back into the skeleton:
</p>
<ul>
<li>
We need to go back between the <code>Delete Joints</code> and the <code>Parent Joints</code> node from the <code>knee_offset</code> chain.

<li>
Drop a <code>Skeleton Blend</code> here:

<ul>
<li>
Rename to <code>skeletonblend_reversefoot</code>

<li>
<code>World Space</code> checked 'on'

<li>
<code>weight</code> to 1

<li>
In the Group field, use the picker to:

<ul>
<li>
Pick the two <span id="13 Reverse Foot Setup-Blending Back-<em>ankles</em>"></span><strong id="<em>ankles</em>"><em>ankles</em></strong> in the Viewport:

<ul>
<li>
<code>Accept</code>

</ul>
</ul>
</ul>
<li>
Now feed the output from the <code>rigpose_foot</code> node into the input 2.

</ul>
<p>
While displaying the <code>ikchains</code> node, and selecting the <code>rigpose_foot</code> we can lift the heel and rotate the toe.
</p>

<p>
If you make any tweaks or tests on the <code>rigpose_foot</code>, clear everything using the <code>clear</code> at the top of the parameters.
</p>


<div id="13 Reverse Foot Setup-Getting Complicated"><h2 id="Getting Complicated" class="header"><a href="#13 Reverse Foot Setup-Getting Complicated">Getting Complicated</a></h2></div>

<p>
Trying not to laugh with frustration - this is getting a bit wild.
</p>

<p>
Anyways...
</p>

<p>
We don't want the heels to be blended back in here, because we have a direct control to them in the rig already.
</p>
<ul>
<li>
Above the <code>rigpose_foot</code> add a <code>Skeleton Blend</code> node:

<ul>
<li>
Rename it to <code>skeletonblend_heels</code>

<li>
<code>World Space</code> checked 'on'

<li>
<code>weight</code> to 1

<li>
In the Group field, use the picker to:

<ul>
<li>
Pick the two <span id="13 Reverse Foot Setup-Getting Complicated-<em>heels</em>"></span><strong id="<em>heels</em>"><em>heels</em></strong> in the Viewport:

<ul>
<li>
<code>Accept</code>

</ul>
</ul>
</ul>
<li>
For the input 2 of this <code>Skeleton Blend</code>:

<ul>
<li>
Pull a wire from the <code>skeletonblend_controls</code>.

</ul>
</ul>
<div id="13 Reverse Foot Setup-More Craziness"><h2 id="More Craziness" class="header"><a href="#13 Reverse Foot Setup-More Craziness">More Craziness</a></h2></div>

<p>
Add an <code>Attach Joint Geo</code> node after the <code>skeleton_heels</code>:
</p>
<ul>
<li>
All the way from the <code>mergedpacked</code> node up above the <code>skeletonblend_conrols</code> pull a wire into the middle input of the <code>Attach Joint Geo</code> node.

<li>
In the Viewport:

<ul>
<li>
Select four joints:

<ul>
<li>
<code>&lt;shift&gt;</code> and select balls x2, toes x2

<li>
<code>G</code> key to enter into the <code>Group</code> field of the <code>Attach Joint Geo</code>.

<li>
<code>&lt;scroll&gt;</code> to choose the circle geo/handles.

</ul>
<li>
Go to <code>Tweak Shapes</code> in the <code>Mode</code> dropdown in the Viewport:

<ul>
<li>
Scale the circles by:

<ul>
<li>
<code>G</code> key

<li>
<code>E</code> key

<li>
Then scale using the gnomon scale tool in the Viewport.

<li>
The tutor settles on 0.3

</ul>
</ul>
</ul>
</ul>
<div id="13 Reverse Foot Setup-Controlling the Toe"><h2 id="Controlling the Toe" class="header"><a href="#13 Reverse Foot Setup-Controlling the Toe">Controlling the Toe</a></h2></div>

<p>
Just before the <code>skeletonblend_ik</code> node:
</p>
<ul>
<li>
Add another <code>Skeleton Blend</code> node:

<ul>
<li>
Rename to <code>skeletonblend_toes</code>

<li>
<code>World Space</code> to 'on'

<li>
<code>weight</code> to 1

</ul>
<li>
Take a forked output from the <code>rigpose_foot</code> node:

<ul>
<li>
plug it into the input 2 of the <code>skeletonblend_toes</code> node.

</ul>
<li>
Use the picker in the Group field of the <code>skeletonblend_toes</code> node:

<ul>
<li>
Pick ball, toe, ball, toe

</ul>
</ul>
<div id="13 Reverse Foot Setup-More Promotion"><h2 id="More Promotion" class="header"><a href="#13 Reverse Foot Setup-More Promotion">More Promotion</a></h2></div>

<p>
On the <code>rigpose_foot</code> node:
</p>
<ul>
<li>
Lock all the Translations, all Scales. (<code>RMB</code> -&gt; Lock Parameter)

<li>
Lock all the Rotations, but:

<ul>
<li>
unlock the <code>y</code> field on each (<code>RMB</code> -&gt; Unlock Parameter)

</ul>
</ul>
<p>
This has the effect of removing the rotation loops for x and z in the Viewport when the balls of the feet or the toes are selected for manipulations.
</p>

<div id="13 Reverse Foot Setup-Adding a Box for the Knees"><h2 id="Adding a Box for the Knees" class="header"><a href="#13 Reverse Foot Setup-Adding a Box for the Knees">Adding a Box for the Knees</a></h2></div>

<p>
In the <code>Main Controls</code> backdrop:
</p>
<ul>
<li>
Add a <code>Box</code> node:

<ul>
<li>
<code>Uniform Scale</code> to 0.02

</ul>
<li>
Drop a <code>Color</code> node:

<ul>
<li>
Set to red.

<li>
Plug the output into the <code>mergepacked1</code> node there in the backdrop.

</ul>
<li>
In the <code>Name 1</code> field of the <code>Merged Packed</code> node:

<ul>
<li>
<code>box_ctrl</code>

</ul>
</ul>
<p>
Above the <code>knee_offset</code> node:
</p>
<ul>
<li>
Drop an <code>Attach Joint Geo</code> node:

<ul>
<li>
Drag a wired from the afore mentioned <code>Merged Packed</code> node:

<ul>
<li>
Plug into the <code>Attach Joint Geo</code> node (second input)

</ul>
</ul>
</ul>
<p>
Display to the <code>Attach Joint Geo</code> node:
</p>
<ul>
<li>
Select the two knee joints in the Viewport:

<ul>
<li>
<code>G</code> key

<li>
Set top bar drop down <code>Mode</code> to <code>Assign Shapes</code>:

<ul>
<li>
<code>&lt;scroll&gt;</code> down through the circle to the box.

</ul>
</ul>
</ul>
<p>
Now if you select further down the chain, these boxes will move out from the knees to follow the knee offset we did earlier.
</p>

<p>
On the <code>knee_offset</code> (rig pose) node:
</p>
<ul>
<li>
Clean up the values:

<ul>
<li>
<code>Translate</code> to <code>-0.15, 0, 0.05</code>

</ul>
</ul>
<div id="13 Reverse Foot Setup-Network Clean up"><h2 id="Network Clean up" class="header"><a href="#13 Reverse Foot Setup-Network Clean up">Network Clean up</a></h2></div>

<p>
The tutor goes ahead and adds a backdrop for all the new nodes and setup:
</p>
<ul>
<li>
Renames to <code>Leg Controls</code>

</ul>
<p>
<br>
<a href="Houdini.html">Houdini</a>
</p>

<p>
<a href="index.html">index</a>
</p>

</body>
</html>
