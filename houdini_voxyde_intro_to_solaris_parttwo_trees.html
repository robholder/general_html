<!DOCTYPE html>
<html>
<head>
<link rel="Stylesheet" type="text/css" href="style.css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<title>houdini_voxyde_intro_to_solaris_parttwo_trees</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<p>
<a href="index.html">index</a>
</p>

<p>
<a href="Houdini.html">Houdini</a>
</p>

<div id="Voxyde - Intro to Solaris - Part Two - Trees"><h1 id="Voxyde - Intro to Solaris - Part Two - Trees" class="header"><a href="#Voxyde - Intro to Solaris - Part Two - Trees">Voxyde - Intro to Solaris - Part Two - Trees</a></h1></div>
<p>
Jump back to the main page:
</p>
<div id="Voxyde - Intro to Solaris - Part Two - Trees-[[houdini_voxyde_intro_to_solaris_parttwo#Trees|Houdini - Voxyde Intro to Solaris - Part Two]]"><h4 id="[[houdini_voxyde_intro_to_solaris_parttwo#Trees|Houdini - Voxyde Intro to Solaris - Part Two]]" class="header"><a href="#Voxyde - Intro to Solaris - Part Two - Trees-[[houdini_voxyde_intro_to_solaris_parttwo#Trees|Houdini - Voxyde Intro to Solaris - Part Two]]"><a href="houdini_voxyde_intro_to_solaris_parttwo.html#Trees">Houdini - Voxyde Intro to Solaris - Part Two</a></a></h4></div>

<div id="Trees"><h1 id="Trees" class="header"><a href="#Trees">Trees</a></h1></div>

<div id="Trees-[[https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=9959s|YouTube - timecode: 02:45:59]]"><h4 id="[[https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=9959s|YouTube - timecode: 02:45:59]]" class="header"><a href="#Trees-[[https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=9959s|YouTube - timecode: 02:45:59]]"><a href="https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=9959s">YouTube - timecode: 02:45:59</a></a></h4></div>

<div id="Trees-Component Builder"><h2 id="Component Builder" class="header"><a href="#Trees-Component Builder">Component Builder</a></h2></div>

<p>
In the Solaris/Stage/USD Context:
</p>
<ul>
<li>
Add a free floating <code>Component Builder</code>:

<ul>
<li>
This will drop a whole network down in the Network Editor

</ul>
<li>
Rename the <code>Component Geometry</code> node to 'tree'

<li>
Rename the <code>Component Output</code> node to 'Tree' (note the capitalization.

</ul>
<p>
Inside the <code>Component Geometry</code>:
</p>
<ul>
<li>
Add a <code>Tommy</code> for scale comparison (not connected):

<ul>
<li>
Translate him 2.4 in <code>X</code> axis

<li>
Template 'Tommy'

</ul>
<li>
Add a <code>Labs Tree Trunk Generator</code> (make sure you have the Labs component installed with Houdini)

<ul>
<li>
General Tab

<ul>
<li>
<code>Length</code> to 15

</ul>
<li>
 Noise &gt; Line Noise Tab:

<ul>
<li>
<code>Enable</code> checkbox 'On'

<li>
Primary:

<ul>
<li>
<code>Intensity</code> to 1.7

<li>
<code>Frequency</code> to 0.25

</ul>
<li>
Secondary:

<ul>
<li>
<code>Intensity</code> to 1.9

<li>
<code>Frequency</code> to 0.1

</ul>
</ul>
</ul>
<li>
Add a <code>Labs Tree Branch Generator</code>:

<ul>
<li>
Connect both ouputs from the 'tree_trunk_generator' to the 'tree_branch_generator'

<li>
General &gt; Placement tab:

<ul>
<li>
<code>Randomize Node Amount</code> checkbox 'On'

</ul>
<li>
Remap Angle Ramp area:

<ul>
<li>
<code>Length</code> to 0.9

<li>
<code>Length Variation</code> to 6

<li>
<code>Length Ramp</code> move the middle ramp point to the right (to make first branches higher start)

</ul>
<li>
General &gt; Radius tab:

<ul>
<li>
<code>Radius Adjust</code> to -0.322

</ul>
<li>
Resolution tab:

<ul>
<li>
<code>Resolution</code> to 0.242

<li>
<code>Divisions</code> to 0.7

</ul>
<li>
Noise tab:

<ul>
<li>
Primary:

<ul>
<li>
<code>Intensity</code> to 3.3

<li>
<code>Frequency</code> to 0.42

</ul>
<li>
Secondary:

<ul>
<li>
<code>Intensity</code> to 1.8

<li>
<code>Frequency</code> to 0.6

</ul>
</ul>
</ul>
<li>
Duplicate this node (<code>Labs Tree Branch Generator</code>) and join underneath the original.

<ul>
<li>
Adjust as follows: 

<li>
General &gt; Placement tab:

<ul>
<li>
<code>Min Branch Nodes</code> to 8

<li>
<code>Max Branch Nodes</code> to 16

<li>
<code>Length</code> to 0.6

<li>
<code>Length Variation</code> will already be 6

<li>
<code>Length Ramp</code> to the left (to start the branching sooner)

</ul>
<li>
Resolution tab:

<ul>
<li>
<code>Resolution</code> to 0.5

<li>
<code>Divisions</code> to 0.8

</ul>
</ul>
<li>
Duplicate THIS node and attach:

<ul>
<li>
Resolution tab:

<ul>
<li>
<code>Resolution</code> to 0.6

<li>
<code>Divisions</code> to 0.9

</ul>
</ul>
<li>
Add a <code>Labs Tree Leaf Generator</code>:

<ul>
<li>
Plug the first and second outputs into the first two on the leaf generator

</ul>
</ul>
<p>
<span id="Trees-Component Builder-NOTE"></span><strong id="NOTE">NOTE</strong>: Solaris adds cards by default for leaves. However, according to the Tutorial commentary, MaterialX shaders don't have a good Alpha/transparency solution as yet (whereas Redshift does for example). So we have to model our own leaf template to avoid any texture solution.
</p>

<div id="Trees-Creating a Leaf"><h2 id="Creating a Leaf" class="header"><a href="#Trees-Creating a Leaf">Creating a Leaf</a></h2></div>

<p>
<span id="Trees-Creating a Leaf-NOTE FROM YOUTUBE COMMENTS"></span><strong id="NOTE FROM YOUTUBE COMMENTS">NOTE FROM YOUTUBE COMMENTS</strong>: There is a <code>Labs Tree Simple Leaf</code> option to substitute for this leaf creation section.
</p>

<p>
But here's the tutorial leaf:
</p>
<ul>
<li>
Create a <code>grid</code>:

<ul>
<li>
<code>Size</code> to 0.3, 0.3

<li>
<code>Rows</code> 6

<li>
<code>Columns</code> 5

</ul>
<li>
Add a <code>Match Size</code> node:

<ul>
<li>
<code>Justify Z</code> to <code>Min</code>

</ul>
<li>
Add a <code>Linear Taper</code>:

<ul>
<li>
Press <code>Enter</code> key on the Viewport

<li>
Press <code>N</code> key to size to 'fit our capture' (?)

<li>
<code>Enable Ramp</code> checkbox to 'On'

<li>
Adjust ramp:

<ul>
<li>
Build a leaf shape (pinched at the base, and tapered to a pinch at the end)

<li>
Switch to <code>B-Spline</code>

</ul>
</ul>
<li>
Add a <code>Bend</code> node to curl around the width:

<ul>
<li>
<code>Enter</code> in the Viewport

<li>
<code>N</code> in the Viewport to fit our capture

<li>
<code>B</code> to switch the axis of the bend in Viewport

<li>
<code>Capture Origin</code> to 0, 0, 0.15 (to start in the center)

<li>
<code>Capture Direction</code> to -1, 0, 0

<li>
<code>Capture Length</code> to 0.15

<li>
<code>Deform in Both Directions</code> check 'On' 

<li>
<code>Bend Angle</code> to 76º

</ul>
<li>
Add another <code>Bend</code> to bend along the length

<li>
Add a <code>Transform</code> node to rotate it back up along <code>Z</code> axis

</ul>
<p>
Plug into Leaf Input (3rd input) on 'tree_leaf_generator', and on the <code>tree_leaf_generator</code> parameters:
</p>
<ul>
<li>
<code>Uniform Scale</code> to 1.2

<li>
<code>Uniform Scale Variation</code> to 0.5

<li>
Delete <code>Tommy</code> - he was there as a scale guide. 

</ul>
<div id="Trees-Prepare Output for Solaris"><h2 id="Prepare Output for Solaris" class="header"><a href="#Trees-Prepare Output for Solaris">Prepare Output for Solaris</a></h2></div>

<p>
During the tree build, a lot of extraneous attributes and groups have built up in the asset.
</p>

<p>
We need to separate the leaves from the tree &amp; branches for material assignment:
</p>
<ul>
<li>
Add a <code>Split</code> node:

<ul>
<li>
<code>Group</code> set to 'leaf' (selected from drop-down at the end of the field)

<li>
Now the left output (first) will be the named group items (leaves)

<li>
The right output (second) will be everything else (Trunk &amp; Branches)

</ul>
<li>
Add a <code>Null</code> and call it 'Leaf_geo' (as first output from the 'split')

<ul>
<li>
Add a <code>Name</code> node and change the <code>Name</code> parameter to 'Leaf_geo'

</ul>
<li>
Add a <code>Null</code> and call it 'Trunk_geo' (as the second output from the 'split')

<ul>
<li>
Add a <code>Name</code> node and change the <code>Name</code> parameter to 'Trunk_geo'

</ul>
<li>
<code>Merge</code> these Nulls back together

<li>
Add an <code>Attribute Delete</code> node:

<ul>
<li>
<code>Delete Non Selected</code> checkbox to 'On'

<li>
Populate just two fields:

<ul>
<li>
<code>Vertex Attributes</code> to 'uv'

<li>
<code>Primitive Attributes</code> to 'name'

</ul>
</ul>
<li>
Add a <code>Group Delete</code> node:

<ul>
<li>
In the <code>Group Names</code> field, and an asterisk to delete all groups

</ul>
<li>
Plug this entire network's output into the <code>default</code> output node (of the SOPNet)

</ul>
<p>
At this point the <code>Scene Graph</code> should look like the following:
</p>
<pre>

|_Favorites
-_/
 +_*_*__class__
 --© Tree
   - 0 geo
   | |_∆ Leaf_geo
   | |_∆ Trunk_geo
   |_0 mtl
   
</pre>

<div id="Trees-Create a Proxy Geometry"><h2 id="Create a Proxy Geometry" class="header"><a href="#Trees-Create a Proxy Geometry">Create a Proxy Geometry</a></h2></div>

<p>
To create a low resolution proxy, you could just add a <code>PolyReduce</code> node and set to 10% or something. However, the leaves get decimated to something non-representative of the silhouette, so the tutorial tries another method.
</p>


<p>
We can treat the trunk &amp; branches and the leaves as two different parts.
</p>

<div id="Trees-Create a Proxy Geometry-Trunk &amp; Branches"><h3 id="Trunk &amp; Branches" class="header"><a href="#Trees-Create a Proxy Geometry-Trunk &amp; Branches">Trunk &amp; Branches</a></h3></div>

<p>
From the <code>Name</code> node on the 'Trunk_geo' section:
</p>
<ul>
<li>
add a <code>Blast</code> node:

<ul>
<li>
Select <code>level0</code> from the <code>Group</code> field's drop-down

<li>
add <code>level1</code> and <code>level2</code> in the same way.

<li>
Check the <code>Delete Non Selected</code> checkbox.

</ul>
<li>
Add a <code>PolyReduce</code> node and set <code>Percent To Keep</code> to 25 (%)

</ul>
<div id="Trees-Create a Proxy Geometry-Leaves"><h3 id="Leaves" class="header"><a href="#Trees-Create a Proxy Geometry-Leaves">Leaves</a></h3></div>

<p>
We can use an <code>SDF</code> to turn the geo into a volume then back. However, we need thickness on the leaves (as they are infinitely slim planes for the render).
</p>

<p>
Rather than incur the cost of an extrude on each leaf the tutorial suggests attaching spheres to points on the leaves and converting those into volumes.
</p>

<p>
From the <code>Name</code> node on the 'Leaf_geo' section:
</p>
<ul>
<li>
Add a <code>Connectivity</code> node:

<li>
<span id="Trees-Create a Proxy Geometry-Leaves-NOTE"></span><strong id="NOTE">NOTE</strong>: The 'Connectivity' node or SOP takes connected points and groups them (essentially isolating each leaf as an entity) and gives it an integer, as a 'class' attribute.

<ul>
<li>
This can be 'inline' as it won't damage the 'render' version

<li>
<code>Connectivity Type</code> should be set to 'Point'

</ul>
</ul>
<div id="Trees-Create a Proxy Geometry-Leaves-[[https://www.youtube.com/watch?v=UuhwWjdD6_E|YouTube - Guide to the Connectivity Node]]"><h4 id="[[https://www.youtube.com/watch?v=UuhwWjdD6_E|YouTube - Guide to the Connectivity Node]]" class="header"><a href="#Trees-Create a Proxy Geometry-Leaves-[[https://www.youtube.com/watch?v=UuhwWjdD6_E|YouTube - Guide to the Connectivity Node]]"><a href="https://www.youtube.com/watch?v=UuhwWjdD6_E">YouTube - Guide to the Connectivity Node</a></a></h4></div>
<ul>
<li>
From the 'Connectivity' node, fork with an:

<ul>
<li>
<code>Extract Centriod</code>:

<ul>
<li>
<code>Run Over</code> to 'Pieces'

<li>
<code>Piece Element</code> to 'Point'

<li>
<code>Piece Attriubte</code> to 'class' (which should be a drop-down option after setting the 'Piece Element' to Point.

</ul>
</ul>
<li>
From the 'Extract Centroid', add a <code>VDB From Particles</code>:

<ul>
<li>
Before connecting to the network:

<ul>
<li>
<code>Voxel Size</code> to 0.4 

<li>
<code>Point Radius Scale</code> to 0.23

<li>
<code>Minimum Radius in Viewport</code> to zero

</ul>
</ul>
<li>
Add a <code>Convert VDB</code>:

<ul>
<li>
<code>Convert To</code> set to 'Polygons'

<li>
<code>Adaptivity</code> to 0.6

</ul>
<li>
Add a <code>PolyReduce</code> node:

<ul>
<li>
set to 50%

</ul>
<li>
Add another <code>Name</code> node (copy from further up the chain on the 'leaf' network). This is to fix the way the name attribute get's messed up through the nodes.

</ul>
<p>
The leaves now have around 14,000 points for their reduced version.
</p>

<ul>
<li>
Now merge the two ends of the fork with a <code>Merge</code>

<li>
Duplicate the <code>Attribute Delete</code> and <code>Group Delete</code> nodes from the main network and add to the end of the Proxy network to clean up the data.

<li>
Plug into the <code>proxy</code> output.

</ul>
<p>
This tutorial doesn't have any plan to do any simulations, so we can ignore the <code>simproxy</code> option.
</p>

<p>
Now when we look at the tree in the Viewport, it'll be the proxy, but when we render, it'll be the full resolution version.
</p>

<div id="Trees-Tree Materials"><h2 id="Tree Materials" class="header"><a href="#Trees-Tree Materials">Tree Materials</a></h2></div>

<p>
At the Stage level, jump into the <code>Material Library</code>.
</p>

<p>
Create a <code>Karma Material Builder</code>:
</p>
<ul>
<li>
Rename to <code>Tree_leaves</code>

<li>
Duplicate:

<ul>
<li>
Call the duplicate <code>Tree_trunk</code>

</ul>
<li>
Inside 'Tree_leaves':

<ul>
<li>
<code>mtlxstandard_surface</code>:

<ul>
<li>
<code>Color</code> to 0, 0.5, 0

</ul>
</ul>
<li>
Inside 'Tree_trunk':

<ul>
<li>
<code>mtlxstandard_surface</code>:

<ul>
<li>
<code>Color</code> to 0.5, 0.35, 0.24

<li>
<code>Specular</code>:

<ul>
<li>
<code>Roughness</code> to 0.5

</ul>
</ul>
</ul>
</ul>
<p>
To do the material assignment:
</p>
<ul>
<li>
Back up to the <code>componentmaterial1</code> node:

<ul>
<li>
From the <code>Scene Graph Path</code> window in the <code>Geometry Spreadsheet</code>:

<ul>
<li>
You can drag the <code>/ASSET/mtl/Tree_trunk</code> into the <code>Material Path</code>

<li>
You can drag the <code>/ASSET/geo/proxy/Trunk_geo</code> into the <code>Primitives</code> field

<li>
To add the 'render' version of the trunk you can copy and re-paste the path in and edit 'proxy' to 'render' as below:

<ul>
<li>
<code>Primitives</code> to '/ASSET/geo/proxy/Trunk_geo /Asset/geo/render/Trunk_geo'

</ul>
</ul>
</ul>
<li>
Click on the <code>Material Assignments</code> counter to add another:

<ul>
<li>
From the <code>Scene Graph Path</code> window in the <code>Geometry Spreadsheet</code>:

<ul>
<li>
You can drag the <code>/ASSET/mtl/Tree_leaves</code> into the <code>Material Path</code>

<li>
You can drag the <code>/ASSET/geo/proxy/Leaf_geo</code> into the <code>Primitives</code> field

<li>
To add the 'render' version of the leaves you can copy and re-paste the path in and edit 'proxy' to 'render' as below:

<ul>
<li>
<code>Primitives</code> to '/ASSET/geo/proxy/Leaf_geo /Asset/geo/render/Leaf_geo'

</ul>
</ul>
</ul>
</ul>
<p>
To see how it's all working, add a <code>Karma Physical Sky</code> node (light) after the <code>Component Output</code> at the end of the tree network.
</p>
<ul>
<li>
<code>Exposure</code> to 2

<li>
<code>Solar Altitude</code> to 20

<li>
<code>Solar Azimuth</code> to 160

</ul>
<div id="Trees-Tree Materials-Material Development"><h3 id="Material Development" class="header"><a href="#Trees-Tree Materials-Material Development">Material Development</a></h3></div>

<div id="Trees-Tree Materials-Material Development-Tree Leaves"><h4 id="Tree Leaves" class="header"><a href="#Trees-Tree Materials-Material Development-Tree Leaves">Tree Leaves</a></h4></div>

<p>
Back in the build for the leaves, we retained an attribute called <code>class</code>. We'll use that in the shader network.
</p>
<ul>
<li>
Inside the <code>Material Builder</code>, inside the <code>Tree_leaves</code> shader network:

<ul>
<li>
Add a <code>USD Prim Var Reader</code> node:

<ul>
<li>
<code>Signature</code> to 'Int'

<li>
<code>Var Name</code> to 'class'

</ul>
<li>
Add an <code>MtlX Random Float</code> node:

<ul>
<li>
Plug the 'out' to the 'mtlxstandard_surface' to the <code>Base</code> ('Base Color') input.

</ul>
</ul>
</ul>
<p>
<span id="Trees-Tree Materials-Material Development-Tree Leaves-NOTE"></span><strong id="NOTE">NOTE</strong>: This won't work for the 'proxy' version (Houdini GL) render, so switch to <code>Karma CPU</code> or <code>Karma XPU</code> to see the results. You should see a random greyscale value on each leaf.
</p>
<ul>
<li>
Add a <code>Karma Ramp Const</code> node:

<ul>
<li>
Color the ramp with dark to light greens (like with the grass)

</ul>
</ul>
<div id="Trees-Tree Materials-Material Development-Getting some translucency"><h4 id="Getting some translucency" class="header"><a href="#Trees-Tree Materials-Material Development-Getting some translucency">Getting some translucency</a></h4></div>

<p>
On the 'mtlxstandard_surface' node:
</p>
<ul>
<li>
<code>Subsurface</code> section:

<ul>
<li>
<code>Subsurface</code> slider to 0.6

<ul>
<li>
Plug the <code>Karma Ramp Const</code> out to the <code>Subsurface_color</code> input also (so <code>Base</code> and <code>Subsurface</code>)

</ul>
<li>
<code>Radius</code> to 0.7, 1, 0.6

<li>
<code>Scale</code> to 0.05 (the units are scene units)  

</ul>
</ul>
<div id="Trees-The Trunk Material"><h2 id="The Trunk Material" class="header"><a href="#Trees-The Trunk Material">The Trunk Material</a></h2></div>

<p>
Jump into the <code>Material Library</code> for the Tree_trunk:
</p>
<ul>
<li>
Drop an <code>MtlX Fractal3D</code> node:

<ul>
<li>
<code>Octaves</code> to 10

<li>
<code>Diminish</code> to 0.86

<li>
Plug the 'out' into the 'base' ('base_color') of the <code>mtlstandard_surface</code>

</ul>
<li>
Before the Fractal node, add an <code>MtlX Texture Coord</code> node:

<ul>
<li>
Plug the 'out' into the Fractal's 'position' input.

</ul>
<li>
Now, between these two nodes, add an <code>MtlX Multiply</code> node:

<ul>
<li>
On the Multiply's Input 2 parameter, set a stretch on the UV

<li>
<code>Signature</code> to 'Vector 2'

<li>
22 x 4

</ul>
<li>
Normalize the output from the Fractal:

<ul>
<li>
Add an <code>MtlX Remap</code> node:

<ul>
<li>
Set <code>Inlow</code> to -1

<li>
Set Inhigh to 1 (the default)

</ul>
</ul>
<li>
Add a <code>Karma Ramp Const</code> node:

<ul>
<li>
Create a spectrum of browns for the bark of the tree trunk.

</ul>
<li>
For the <code>Normals</code>, you can duplicate the network up to and including the <code>MtlX Fractal3D</code> node.

<ul>
<li>
On the Fractal node:

<ul>
<li>
<code>Octaves</code> to 4

</ul>
<li>
On the Multiply node:

<ul>
<li>
15 x 3

</ul>
</ul>
<li>
Add an <code>MtlX Height to Normals</code> node:

<ul>
<li>
<code>Scale</code> to 0.05

</ul>
<li>
Add an <code>Mtlx Normal Map</code> node:

<ul>
<li>
'Out' to <code>Geometry &gt; Normals</code> input on the 'mtlstandard_surface'

</ul>
</ul>
<p>
Optionally, you could plug the out from the Normals 'fractal' node and plug it directly into the <code>displacement</code> input on the <code>mtlxdisplacement</code> node, and adjust the scale on the displacement node to 0.1, but the tutorial shows it then removes for the purpose of the exercise.
</p>



<div id="Tree Geo &amp; Material Variation"><h1 id="Tree Geo &amp; Material Variation" class="header"><a href="#Tree Geo &amp; Material Variation">Tree Geo &amp; Material Variation</a></h1></div>
<div id="Tree Geo &amp; Material Variation-[[https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=11841s|YouTube - timecode: 03:17:21]]"><h4 id="[[https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=11841s|YouTube - timecode: 03:17:21]]" class="header"><a href="#Tree Geo &amp; Material Variation-[[https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=11841s|YouTube - timecode: 03:17:21]]"><a href="https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=11841s">YouTube - timecode: 03:17:21</a></a></h4></div>

<ul>
<li>
Variants can be chosen after the <code>Component Geometry</code> node (where the trees are created)

<li>
Example:

<ul>
<li>
Inside the <code>Component Geometry</code> just create 3 platonic solids (all different)

<li>
Plug these into a <code>Switch</code> node and on this node:

<ul>
<li>
Set the <code>Select Input</code> to an expression - <code>@GEOVARIANTINDEX</code>

<li>
This populates the variable to be picked up by the variants nodes:

</ul>
</ul>
<li>
Add a <code>Component Geometry Variants</code> node after the <code>Component Geomtry</code> node:

<ul>
<li>
Set its <code>Source Mode</code> to <code>Number</code>

<li>
Set the <code>Number of Variants</code> to the number of items that are plugged into the switch node as created below.

<li>
<code>Variant Name</code> has a default expression of <code>'$OS'_'@index'</code> (Use backticks, not quotes - can't show those in markdown)

<ul>
<li>
The <code>$OS</code> expands to the name of the node itself (the <code>Component Geometry Variants</code> node)

<li>
The <code>@index</code> to the index of each of the inputs in the <code>@GEOVARIANTINDEX</code> expression/variable

</ul>
</ul>
<li>
Add a <code>Set Variant</code> node somewhere down the network:

<ul>
<li>
This node will allow you to actually choose the variants

<li>
In the parameters (<code>Variant Set</code> set to 'geo'):

<ul>
<li>
<code>Variant Name</code> field can be populated by a choice related to the 'Variant Name' setup (there is a drop-down too)

<li>
These will be named and indexed by that expression (item one will have a 0 suffix, item two will have 1)

</ul>
</ul>
</ul>
<div id="Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Geometry"><h2 id="Creating Procedural Variations of the Tree Geometry" class="header"><a href="#Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Geometry">Creating Procedural Variations of the Tree Geometry</a></h2></div>

<p>
Putting this into action with the trees, we can go a step further and randomize aspects of the trees instead of creating defined individual variant models.
</p>

<p>
We'll add randomization to the 'levels' of branch creation.
</p>

<p>
At the <code>Stage</code> level:
</p>
<ul>
<li>
Add a <code>Component Geometry Variants</code> node after the <code>tree</code> node ('Component Geometry')

<ul>
<li>
<code>Source Mode</code> to 'Number' to use a setup inside the 'tree' node to produce variant seeds. 

<li>
Set <code>Number of Variants</code> to 6

</ul>
<li>
Back in the 'tree' <code>Component Geometry</code> node (where the trees are set up):

<ul>
<li>
On the 'tree_trunk_generator' node:

<ul>
<li>
In the <code>Noise</code> &gt; <code>Line Noise</code> tab:

<ul>
<li>
<code>Offset</code> parameters (Primary &amp; Secondary), add <code>@GEOVARIANTINDEX</code> or even <code>@GEOVARIANTINDEX * 3</code> to multiply the index.

</ul>
</ul>
<li>
On the 'tree_branch_generator1' node:

<ul>
<li>
in the <code>Randomize</code> field, add the same expression, <code>@GEOVARIANTINDEX</code>

</ul>
<li>
Do this step for all the 'tree_branch_generator' nodes

</ul>
<li>
You can temporarily fork a <code>Set Variant</code> node from the 'Tree' ('Component Output') node (before the lighting), and choose from the <code>Variant Name</code> field (via the drop-down)

</ul>
<p>
This will all take a while to 'cook' as all the variants are evaluated by Houdini.
</p>

<ul>
<li>
You can also put an <code>Explore Variants</code> node after the 'Tree' node and before the <code>Karma Physical Sky</code> node:

<ul>
<li>
Set the <code>Mode</code> to <code>Explore Variants</code>

<li>
Increase the <code>Spacing</code> to 15

</ul>
<li>
Again the network will take time to evaluate.

<li>
When 'cooked', you should be able to Karma render the results

</ul>
<div id="Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Materials"><h2 id="Creating Procedural Variations of the Tree Materials" class="header"><a href="#Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Materials">Creating Procedural Variations of the Tree Materials</a></h2></div>

<div id="Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Materials-[[https://youtu.be/3BX97YIQERE?si=c3d0Xe6H87LXedSs&amp;t=12322|YouTube - timecode: 03:25:22]]"><h4 id="[[https://youtu.be/3BX97YIQERE?si=c3d0Xe6H87LXedSs&amp;t=12322|YouTube - timecode: 03:25:22]]" class="header"><a href="#Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Materials-[[https://youtu.be/3BX97YIQERE?si=c3d0Xe6H87LXedSs&amp;t=12322|YouTube - timecode: 03:25:22]]"><a href="https://youtu.be/3BX97YIQERE?si=c3d0Xe6H87LXedSs&amp;t=12322">YouTube - timecode: 03:25:22</a></a></h4></div>

<div id="Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Materials-Leaf - Leaves"><h3 id="Leaf - Leaves" class="header"><a href="#Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Materials-Leaf - Leaves">Leaf - Leaves</a></h3></div>

<p>
Instead of the previously discussed method of creating multiple <code>Karma Material Builder</code> networks, this time we'll create a colorcorrect node to adjust variations.
</p>

<p>
Inside the <code>Tree_leaves</code> network (inside the <code>Material Library</code> for the leaves:
</p>
<ul>
<li>
After the <code>Karma Ramp Const</code> node:

<ul>
<li>
Add a <code>MtlX Color Correct</code> node:

<ul>
<li>
Rewire:

<ul>
<li>
Plug the ramp 'out' to the 'color correct' 'in'

<li>
Plug the 'out' of the 'color correct' to the 'Base (color)' and 'Subsurface (color)' of the end node.

</ul>
</ul>
<li>
Add a free-floating <code>USD Prim Var Reader</code> node:

<ul>
<li>
Usually we use this node to pull in an attribute, but this time we'll create one!

<li>
We want to drive the <code>Hue</code> parameter on the 'color correct', so we'll make the <code>Signature</code> a 'Float'

<li>
<code>Var Name</code> to 'hue'

<li>
<code>Fallback Value</code> leave as zero (since that's the rest value of 'Hue')

<li>
Plug the 'result' output into the <code>hue</code> input on the 'color correct'

</ul>
</ul>
<li>
Now jump up to the <code>Stage</code> and:

<ul>
<li>
Add a <code>Material Variation</code> after the 'Karma Physical Sky' node:

<ul>
<li>
If you look in the <code>Scene Graph</code> (on the Geometry Spreadsheet) you'll see the 'explore variants' list.

<li>
In the 'Material Variation' parameters, we need to set the <code>Primitives</code> path:

<ul>
<li>
Drag the first Leaf_geo nodes (from the 'Scene Graph' onto the field:

<ul>
<li>
<code>/explorevariants1/Tree/geo_tree_variant_0_mtl_componentmaterial1/geo/render/Leaf_geo</code>

</ul>
</ul>
<li>
For the <code>Name</code> field, the drop-down should now list the attributes, including <code>hue-float</code>

<ul>
<li>
Selecting this will result in the field being populated with <code>hue</code>

</ul>
<li>
The magic happens when we adjust the <code>Value</code> slider:

<ul>
<li>
the value transfers to the <code>Hue</code> of the 'color correct'

</ul>
</ul>
</ul>
</ul>
<p>
This setup changes the <code>Hue</code> value of ONLY the tree we dragged into the <code>Primitives</code> field. Not what we want.
</p>

<div id="Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Materials-Setting individual variations for each variant"><h3 id="Setting individual variations for each variant" class="header"><a href="#Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Materials-Setting individual variations for each variant">Setting individual variations for each variant</a></h3></div>

<p>
Back in the <code>Material Variation</code> node at the end of the network:
</p>
<ul>
<li>
Change the <code>Primitives</code> path to a path with wildcards to pick up ALL the variants:

<ul>
<li>
<code>*/geo/render/Leaf_geo</code> 

<li>
This will find all the 'Leaf_geo' items by wildcarding into the hierarchy.

<li>
Now changing the <code>Value</code> slider will change the <code>hue</code> on all the trees equally. Still not what we want.

</ul>
<li>
Switch on the <code>Use Snippet</code> checkbox (to allow us to use a VEXpression):

<ul>
<li>
As an illustration, we could type:

<ul>
<li>
<code>value = 0.5;</code> And the trees will all change to a purple in this case. (The range is from 0 to 1)

</ul>
<li>
The expression in the tutorial is:

<ul>
<li>
<code>value = fit01(rand(index), -0.1, 0.1);</code>

<li>
This creates a random value using the index number as a seed, and fitting the result between -0.1 and 0.1.

</ul>
</ul>
<li>
SAVE THE SCENE - AND TURN OFF KARMA CPU/XPU IN THE VIEWPORT (until the gamma setup is done).

<li>
Now, you can duplicate the <code>USD Prim Var Reader</code> node back in the <code>Tree_leaves</code> shader network, and plug into other parameters (like 'gamma'):

<ul>
<li>
Just change the <code>Name</code> parameter on the node to 'gamma' for example

<li>
Note that the 'gamma' fallback value (number) is '1' (not zero as in 'Hue')

</ul>
<li>
Back in the <code>Material Variation</code> node:

<ul>
<li>
Click the <code>+</code> on the <code>Primvars</code> parameter to make another section

<li>
In the new section:

<ul>
<li>
<code>Name</code> to 'gamma' (from the drop-down if you like)

<li>
<code>Use Snippet</code> on and add another expression (note the different range):

<ul>
<li>
<code>value = fit01(rand(index), 0.7, 1.5);</code>

</ul>
</ul>
</ul>
</ul>
<div id="Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Materials-Reference Option"><h3 id="Reference Option" class="header"><a href="#Tree Geo &amp; Material Variation-Creating Procedural Variations of the Tree Materials-Reference Option">Reference Option</a></h3></div>

<p>
The tutorial shows how you can select the <code>Save to Disk</code> on the 'Tree' <code>Component Output</code> node, and read it in with a <code>Reference</code> node, before continuing through the rest of the network.
</p>
<ul>
<li>
Once saved (<code>Save to Disk</code>):

<ul>
<li>
<code>MMB</code> on the label, <code>Location</code> (to expand the path)

<li>
Copy the path from the <code>Location</code> field

</ul>
<li>
On the <code>Reference</code> node, paste this path into the <code>File Pattern</code> field

</ul>
<p>
We will pull in this reference Tree in the next section.
</p>

<div id="Tree Geo &amp; Material Variation-Setting up the Hero Trees"><h2 id="Setting up the Hero Trees" class="header"><a href="#Tree Geo &amp; Material Variation-Setting up the Hero Trees">Setting up the Hero Trees</a></h2></div>

<p>
Before setting up Hero Trees in out main Stage Network, you can drop some <code>Network Boxes</code> around the 'ground' elements (Ground, grass &amp; water), and name <code>Ground</code>.
</p>

<p>
Now to bring in the Tree (which we saved to disk):
</p>
<ul>
<li>
Add a <code>Stage Manager</code>:

<li>
In its parameter pane, in the panel's <code>File Browser</code>:

<ul>
<li>
Hunt for the <code>Tree.usd</code> file (or copy &amp; paste the path from the 'Tree' <code>Component Output</code> node again)

<li>
Drag this from the <code>File Browser</code> to the <code>Scene Graph</code> section of the parameter pane.

</ul>
</ul>
<p>
<span id="Tree Geo &amp; Material Variation-Setting up the Hero Trees-NOTE"></span><strong id="NOTE">NOTE</strong>: If any work is done on the original tree setup, we have to re-save to disk. This overwritten file will then be pulled into the scene using the <code>Stage Manager</code> reference.
</p>

<p>
Merge this <code>Stage Manger</code> (Tree) into the main scene network:
</p>
<ul>
<li>
After the Ground merge, add a <code>Merge</code> node:

<ul>
<li>
Connect the Tree <code>Stage Manager</code> as the second input.

</ul>
<li>
View this merge node or later to see the ground with the tree.

<li>
Select the <code>Stage Manager</code> node, and with the transform handle in the Viewport (<code>Enter</code> key in the Viewport), move the tree as desired.

</ul>
<p>
In the tutorial, the <code>Geometry Spreadsheet</code> window is hidden by clicking on the down arrow on the divider bar.
</p>
<ul>
<li>
<span id="Tree Geo &amp; Material Variation-Setting up the Hero Trees-WARNING"></span><strong id="WARNING">WARNING</strong>: The following shortcuts are OS dependent: 

<li>
<code>LINUX/WINDOWS</code>

<ul>
<li>
<code>&lt;cntl&gt; 2</code> is used to split the Viewport (right/left) then

<li>
<code>&lt;cntl&gt; 2</code> again to swap the Viewport to top/bottom split.

</ul>
<li>
<code>MACOS</code>

<ul>
<li>
<code>&lt;cmd&gt; 2</code> is used to split the Viewport (right/left) then

<li>
<code>&lt;cmd&gt; 2</code> again to swap the Viewport to top/bottom split.

</ul>
<li>
The bottom view is set to the <code>Camera</code> (the top to perspective view)

</ul>
<p>
In the Viewport while placing the tree, you can:
</p>
<ul>
<li>
<span id="Tree Geo &amp; Material Variation-Setting up the Hero Trees-WARNING"></span><strong id="WARNING">WARNING</strong>: The following shortcuts are OS dependent: 

<li>
<code>LINUX/WINDOWS</code>

<ul>
<li>
<code>&lt;cntl&gt; D</code> to duplicate and place another tree.

</ul>
<li>
<code>MACOS</code>

<ul>
<li>
<code>&lt;cmd&gt; D</code> to duplicate and place another tree.

</ul>
<li>
Magic bit:

<ul>
<li>
<code>RMB</code> click on the tree and select the required variant! (<code>mtl</code> or <code>geo</code> variations).

<li>
You can also set the variant in the <code>Stage Manager</code> parameters pain:

<ul>
<li>
<code>Inspector</code> tab:

<ul>
<li>
<code>mtl</code> drop-down (<span id="Tree Geo &amp; Material Variation-Setting up the Hero Trees-NOTE"></span><strong id="NOTE">NOTE</strong>: Because the material variants were sorted after the Tree.usd export, this only shows one variant. I can't figure out a solution as yet.)

<li>
<code>geo</code> drop-down

</ul>
</ul>
</ul>
</ul>
<p>
The tutorial sets around four trees in the middle to foreground using this Hero tree technique.
</p>

<p>
Setting the USD Scene Graph hierarchy for these new Trees:
</p>
<ul>
<li>
In the <code>Stage Manager</code> parameter panel:

<ul>
<li>
Click on the little <code>+</code> icon in the Scene Graph view (in the 'Stage Manager' parameters)

<li>
Name it <code>Env</code>:

<ul>
<li>
Click the <code>+</code> icon and add another sub directory/layer and call it <code>trees</code>

<li>
Click the <code>+</code> icon again, and name the new layer, <code>hero_trees</code>:

<ul>
<li>
Select all the Trees, and drag &amp; drop them into the <code>hero_trees</code> layer.

<li>
(<span id="Tree Geo &amp; Material Variation-Setting up the Hero Trees-SPOILER"></span><strong id="SPOILER">SPOILER</strong> We'll later add an <code>intance_trees</code>)

</ul>
</ul>
</ul>
</ul>
<div id="Tree Geo &amp; Material Variation-Instancing Trees"><h2 id="Instancing Trees" class="header"><a href="#Tree Geo &amp; Material Variation-Instancing Trees">Instancing Trees</a></h2></div>
<div id="Tree Geo &amp; Material Variation-Instancing Trees-[[https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=13169s|YouTube - timecode: 03:39:29]]"><h4 id="[[https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=13169s|YouTube - timecode: 03:39:29]]" class="header"><a href="#Tree Geo &amp; Material Variation-Instancing Trees-[[https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=13169s|YouTube - timecode: 03:39:29]]"><a href="https://www.youtube.com/watch?v=3BX97YIQERE&amp;t=13169s">YouTube - timecode: 03:39:29</a></a></h4></div>

<p>
First we have to create 'points' geometry to use as the starter for the instances.
</p>

<p>
We have an option to use and <code>Instancer</code> node as either an 'inline' node or <code>Merge</code> as a separate fork. The tutorial goes ahead with an 'inline' option.
</p>

<ul>
<li>
Drop an <code>Instancer</code> node after the <code>Stage Manager</code> that contains our 'hero' trees:

<ul>
<li>
Name it <code>BG_trees</code>

<li>
The <code>Stage Manager</code> node should be plugged into the first (left) input:

<ul>
<li>
Feel free to break this connection to preview, then reconnect when done.

</ul>
</ul>
<li>
Add a free-floating <code>Reference</code> node:

<ul>
<li>
<code>File Pattern</code> is the path to the Tree.usd that we 'Saved to Disk'

<li>
It'll plug into input 2 of the Instancer/BG_trees

</ul>
</ul>
<p>
Create the point geometry inside the Instancer:
</p>
<ul>
<li>
Start with a solitary point:

<ul>
<li>
Add and <code>Add</code> node:

<ul>
<li>
<code>Number of Points</code> is 1

<li>
To see the result you can cut the wire from the 'Stage Manager' to the 'Instancer'

<li>
There should be one tree at the origin.

</ul>
</ul>
</ul>
<p>
Back up to the Stage level, and adjust the <code>Instancer</code> ('BG_trees' node)
</p>
<ul>
<li>
<code>Primitive Path</code> to <code>/Env/trees/BG_trees</code> (or, '/Env/trees/$OS' to use the name of the node in the path).

</ul>
<p>
This results in a single variant, so to expand the posibilities:
</p>
<ul>
<li>
Drop an <code>Explore Variants</code> between the reference and the instancer nodes:

<ul>
<li>
Rename it <code>tree_variants</code>

<li>
Set the <code>Mode</code> to <code>Explore Variants</code>

<li>
Set the <code>Spacing</code> to zero (so they'll all be at the origin) 

<li>
In the 'Scene Graph' view of the 'Geometry Spreadsheet' panel:

<ul>
<li>
It'll show up as green indicating it has a 'Composition Arc'

<li>
This needs to be flattened

<li>
Drop a <code>Configure Layer</code> node after the 'Explore Variants' node:

<ul>
<li>
<code>Flatten input</code> drop-down should be, <code>Flatten Input Stage</code>

<li>
This will get rid of the 'Composition Arc' status

</ul>
</ul>
</ul>
</ul>
<p>
Now the path to the Primitives needs to be updated to account for all the edits:
</p>
<ul>
<li>
On the <code>BG_trees</code> ('Instancer') node:

<ul>
<li>
<code>Prototype Primitives</code> from the default expression to:

<ul>
<li>
<code>/tree_variants/Tree/*</code>

</ul>
</ul>
</ul>
<p>
To see if the variants are working with multiple points:
</p>
<ul>
<li>
Inside the <code>BG_trees</code> ('Instancer') node, create a grid, 200 x 200, rows &amp; columns to 5 x 5, and mark as renderable:

<ul>
<li>
This should scatter the tree variants on the points of the grid.

<li>
We can assess if the variant is working.

</ul>
</ul>
<p>
When everything is working, we can delete the <code>Add</code> and <code>Grid</code> nodes from the 'Instancer'. We need to create some genuine geometry to create the geometry to produce the scatter points for the instanced trees for the scene.
</p>

<p>
Inside the <code>Instancer</code> ('BG_trees'):
</p>
<ul>
<li>
Drop a <code>Circle (Polygons)</code>:

<ul>
<li>
Set <code>Arc Type</code> to <code>Open Arc</code>

<li>
Set <code>Orientation</code> to <code>ZX Plane</code>

<li>
Enlarge the <code>Uniform Scale</code> to 75

<li>
Set <code>Arc Angles</code> to create an area for scatters:

<ul>
<li>
237 x 351

</ul>
</ul>
<li>
Add a <code>Scatter</code> node:

<ul>
<li>
<code>Force Total Count</code> to 40

<li>
Disable <code>Relax Iterations</code>

</ul>
<li>
Add a <code>Point Jitter</code>:

<ul>
<li>
Set <code>Scale</code> to 100

<li>
<code>Axis Scales</code> <code>Y</code> parameter to zero (to keep them ground/zero level), or simply, 1, 0, 1

<li>
Play around with <code>Seed</code>, maybe 2.83

</ul>
</ul>
<p>
Moving back up the <code>Stage</code> level, we should see instanced trees inside the semi-circle or arc. Adjusting the 'Point Jitter' seed will reflect as new random tree placement. Of course, editing the circle-arc will also determine where the trees are spawned. Changing the 'uniform scale' of the circle will push the trees back in our camera view.
</p>

<p>
<br>
<br>
Jump back to the main page to continue with a Fog Box next:
</p>
<div id="Tree Geo &amp; Material Variation-Instancing Trees-[[houdini_voxyde_intro_to_solaris_parttwo#Karma Fog Box|Houdini - Voxyde Intro to Solaris - Part Two (continued)]]"><h4 id="[[houdini_voxyde_intro_to_solaris_parttwo#Karma Fog Box|Houdini - Voxyde Intro to Solaris - Part Two (continued)]]" class="header"><a href="#Tree Geo &amp; Material Variation-Instancing Trees-[[houdini_voxyde_intro_to_solaris_parttwo#Karma Fog Box|Houdini - Voxyde Intro to Solaris - Part Two (continued)]]"><a href="houdini_voxyde_intro_to_solaris_parttwo.html#Karma Fog Box">Houdini - Voxyde Intro to Solaris - Part Two (continued)</a></a></h4></div>

<p>
<a href="Houdini.html">Houdini</a>
</p>

<p>
<a href="index.html">index</a>
</p>

</body>
</html>
