<!DOCTYPE html>
<html>
<head>
<link rel="Stylesheet" type="text/css" href="style.css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<title>vim_backups_and_swap</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<p>
<a href="index.html">index</a>
</p>

<p>
<a href="vim_learning.html">Vim Learning</a>
</p>

<div id="Vim - Backups &amp; Swap Files"><h1 id="Vim - Backups &amp; Swap Files" class="header"><a href="#Vim - Backups &amp; Swap Files">Vim - Backups &amp; Swap Files</a></h1></div>


<pre vimrc>
" Backup Settings Block:
" ----------------------
" Ensure backups are created and stored in designated directories.
" - Creates the ~/.vim/backup directory if it doesn't exist.
" - Prioritizes local .vim-backup/ directory for project-specific backups.
" - Falls back to ~/.vim/backup for centralized backups.
" - Prevents clutter by avoiding backups in the working directory or home folder.
if isdirectory($HOME . '/.vim/backup') == 0
    :silent !mkdir -p ~/.vim/backup
endif

if isdirectory($HOME . '/.vim/backup')
    set backupdir+=.
    set backupdir-=~/
    set backupdir^=~/.vim/backup/
    set backupdir^=./.vim-backup/
    set backup
    set backupext=.bak " set backup file extension to .bak
endif
</pre>

<p>
This vimrc block is a standard configuration used to manage and store backup files created by Vim in specific, organized directories, preventing them from cluttering your working directories.
</p>

<p>
It's essentially a logic check: If it can create a dedicated backup directory and if that directory exists, then it defines a prioritized list of locations where Vim should save the backup files.
</p>

<p>
Here is a breakdown of what each section does:
</p>

<div id="Vim - Backups &amp; Swap Files-Directory Creation (The &quot;Setup&quot;)"><h2 id="Directory Creation (The &quot;Setup&quot;)" class="header"><a href="#Vim - Backups &amp; Swap Files-Directory Creation (The &quot;Setup&quot;)">Directory Creation (The "Setup")</a></h2></div>

<pre vim>
if isdirectory($HOME . '/.vim/backup') == 0
    :silent !mkdir -p ~/.vim/backup
endif
</pre>
<ul>
<li>
<code>if isdirectory($HOME . '/.vim/backup') == 0</code>: This checks if the backup directory <code>~/.vim/backup</code> (e.g., <code>/home/user/.vim/backup</code>) does not exist (<code>== 0</code> is false).

<li>
<code>:silent !mkdir -p ~/.vim/backup</code>: If the directory doesn't exist, this command creates it.

<ul>
<li>
<code>:silent</code>: Suppresses any output from the shell command, keeping your Vim session clean.

<ul>
<li>
<code>!</code>: Executes the following command in the external system shell.  <code>mkdir -p</code>: Creates the directory. The <code>-p</code> flag ensures that parent directories are also created if they don't exist, and it prevents an error if the directory already exists (though the <code>if</code> check should prevent this).

</ul>
</ul>
</ul>
<div id="Vim - Backups &amp; Swap Files-Backup Location Configuration (The &quot;Chain&quot;)"><h2 id="Backup Location Configuration (The &quot;Chain&quot;)" class="header"><a href="#Vim - Backups &amp; Swap Files-Backup Location Configuration (The &quot;Chain&quot;)">Backup Location Configuration (The "Chain")</a></h2></div>

<pre vim>
if isdirectory($HOME . '/.vim/backup')
    set backupdir+=.
    set backupdir-=~/
    set backupdir^=~/.vim/backup/
    set backupdir^=./.vim-backup/
    set backup
    set backupext=.bak " set backup file extension to .bak
endif
</pre>

<p>
This entire block only runs if the directory ~/.vim/backup exists (meaning it was either just created or already existed). The commands manipulate the backupdir option, which is a comma-separated list of directories where Vim searches for and places backup files, in order.
</p>

<table>
<tr>
<td>
Command
</td>
<td>
Explanation
</td>
</tr>
<tr>
<td>
set backupdir+=.
</td>
<td>
Adds the current directory (.) to the end of the list. This is a common default fallback.
</td>
</tr>
<tr>
<td>
set backupdir-=~/
</td>
<td>
Removes the user's home directory (~/) from the list. This is often the default value, and this line ensures backups aren't saved directly in the home directory.
</td>
</tr>
<tr>
<td>
set backupdir^=~/.vim/backup/
</td>
<td>
Prepends (adds to the beginning) your central, dedicated backup directory to the list. This makes it the highest priority location.
</td>
</tr>
<tr>
<td>
set backupdir^=./.vim-backup/
</td>
<td>
Prepends a directory named .vim-backup inside the current directory. This becomes the new highest priority, allowing project-specific backups to be saved here first.
</td>
</tr>
<tr>
<td>
set backup
</td>
<td>
Turns on the backup feature, telling Vim to actually create backup files.
</td>
</tr>
<tr>
<td>
set backupext=.bak
</td>
<td>
Sets the extension for backup files to .bak (e.g., a file named report.txt will have a backup named report.txt.bak).
</td>
</tr>
</table>

<div id="Vim - Backups &amp; Swap Files-The Final Backup Directory Priority Chain"><h2 id="The Final Backup Directory Priority Chain" class="header"><a href="#Vim - Backups &amp; Swap Files-The Final Backup Directory Priority Chain">The Final Backup Directory Priority Chain</a></h2></div>

<p>
After this block executes, the effective chain of locations Vim will try to save a backup file to (from highest to lowest priority) is:
</p>

<ul>
<li>
<code>./.vim-backup/</code> (A folder inside the current project/directory)

<li>
<code>~/.vim/backup/</code> (Your centralized backup folder)

<li>
<code>.</code> (The current directory itself)

</ul>
<div id="Safe Writes (with Temporary Backup)"><h1 id="Safe Writes (with Temporary Backup)" class="header"><a href="#Safe Writes (with Temporary Backup)">Safe Writes (with Temporary Backup)</a></h1></div>

<pre vim>
" Writebackup Settings Block:
" ----------------------------
" Configures writebackup to temporarily save the original file in the same directory
" during write operations. Ensures safety against data loss during save failures.
if exists("+writebackup")
    set writebackup
endif
</pre>

<p>
This block of code specifically deals with a safety feature in Vim during the file-writing process:
</p>


<pre vim>
if exists("+writebackup")
    set writebackup
endif
</pre>

<p>
Here is a detailed explanation of what it does and how it relates to leaving "litter" in directories.
</p>

<div id="Safe Writes (with Temporary Backup)-What the Code Does"><h2 id="What the Code Does" class="header"><a href="#Safe Writes (with Temporary Backup)-What the Code Does">What the Code Does</a></h2></div>

<ul>
<li>
<code>if exists("+writebackup")</code>: This checks if the Vim option <code>writebackup</code> is available in the current version of Vim/Neovim being used. This is a common way to ensure backward compatibility for options that might not exist in older versions of Vi or Vim.

<li>
<code>set writebackup</code>: If the option exists, this line explicitly turns it on.

</ul>
<div id="Safe Writes (with Temporary Backup)-What the Code Does-What set writebackup does:"><h4 id="What set writebackup does:" class="header"><a href="#Safe Writes (with Temporary Backup)-What the Code Does-What set writebackup does:">What set writebackup does:</a></h4></div>

<p>
<code>writebackup</code> is a crucial safety mechanism that determines how Vim saves a file:
</p>

<ul>
<li>
<span id="Safe Writes (with Temporary Backup)-What the Code Does-What set writebackup does:-Before Overwriting"></span><strong id="Before Overwriting">Before Overwriting</strong>: When you issue a write command (:w), Vim first makes a temporary backup copy of the original, unmodified file.

<li>
<span id="Safe Writes (with Temporary Backup)-What the Code Does-What set writebackup does:-Writing"></span><strong id="Writing">Writing</strong>: Vim then writes the new buffer content to the original filename.

<li>
<span id="Safe Writes (with Temporary Backup)-What the Code Does-What set writebackup does:-Cleanup"></span><strong id="Cleanup">Cleanup</strong>: If the write is successful, Vim immediately and automatically deletes the temporary backup file.

</ul>
<p>
This process is sometimes called "atomic writing" and is essential for preventing data loss. If Vim crashes, the power goes out, or the disk becomes full during the write operation, the original file is still safe and intact because the write happened to a new file (or the original was renamed) and the original's content is in the temporary backup.
</p>

<div id="Safe Writes (with Temporary Backup)-What the Code Does-Does it Leave &quot;Litter&quot; in Directories?"><h3 id="Does it Leave &quot;Litter&quot; in Directories?" class="header"><a href="#Safe Writes (with Temporary Backup)-What the Code Does-Does it Leave &quot;Litter&quot; in Directories?">Does it Leave "Litter" in Directories?</a></h3></div>

<p>
The answer is No, not by itself.
</p>

<p>
When writebackup is set (and backup is not set, which is the default for a clean Vim setup), the backup file is transientâ€”it's created for safety during the save and immediately deleted upon success.
</p>

<p>
The Key Difference: <code>backup</code> vs. <code>writebackup</code>
<table>
<tr>
<td>
Option
</td>
<td>
Function
</td>
<td>
Litter/Files Left?
</td>
</tr>
<tr>
<td>
writebackup
</td>
<td>
Safety mechanism.
</td>
<td>
Creates a temp file while writing. Deletes it immediately upon success.	No (The file is only present for a fraction of a second during the write).
</td>
</tr>
<tr>
<td>
backup
</td>
<td>
Archival feature (enabled by set backup).
</td>
<td>
Creates a permanent backup of the previous file version.	Yes (A file with the backupext extension, like filename.txt.bak, is left behind).
</td>
</tr>
</table>
</p>

<p>
In the context of the previous backup blocks of code featured above:
</p>

<p>
If you have a <code>set backup</code> block, it is the combination of <code>set backup</code> and the <code>backupdir</code> settings that is responsible for leaving files behind (archival backups), not the set writebackup command itself.
</p>

<p>
The full configuration means:
</p>

<ul>
<li>
<code>set writebackup</code> is on: Use the safe, temporary backup method for all writes.

<li>
<code>set backup</code> is on: Keep the temporary backup file (the one created by writebackup) and turn it into a permanent, archival backup.

<li>
<code>set backupdir</code> is configured: Store that permanent archival backup in a neat, centralized location (like ~/.vim/backup/), thus preventing litter in the current working directory.

</ul>
<div id="Swap Files"><h1 id="Swap Files" class="header"><a href="#Swap Files">Swap Files</a></h1></div>

<p>
The core difference between backups and Swap Files is their purpose and lifespan: Swap files are for crash recovery and session data, while Backup files (using backup and writebackup) are for version control and data safety during a save.
</p>

<p>
Your new vimrc block is configuring how Vim manages these essential Swap files.
</p>

<pre vim>
if isdirectory($HOME . '/.vim/swap') == 0
    :silent !mkdir -p ~/.vim/swap
endif
"
" - Set up chain of priority and fallbacks for swap file locations:
if isdirectory($HOME . '/.vim/swap')
    set directory=./.vim-swap//
    set directory+=~/.vim/swap//
    set directory+=~/tmp//
    set directory+=.
    set swapfile
endif
</pre>

<div id="Swap Files-Swap Files vs. Backup Files"><h2 id="Swap Files vs. Backup Files" class="header"><a href="#Swap Files-Swap Files vs. Backup Files">Swap Files vs. Backup Files</a></h2></div>

<table>
<tr>
<td>
Feature
</td>
<td>
Swap Files (.swp)
</td>
<td>
Backup Files (.bak, etc.)
</td>
</tr>
<tr>
<td>
Vim Option
</td>
<td>
directory, swapfile
</td>
<td>
backup, backupdir, backupext
</td>
</tr>
<tr>
<td>
Purpose
</td>
<td>
Crash Recovery &amp; Session Data. Stores the unsaved state of the buffer in case of a crash, power loss, or when a file is opened twice.
</td>
<td>
Archival &amp; Version Control. Stores a copy of the file before the latest save operation.
</td>
</tr>
<tr>
<td>
Lifespan
</td>
<td>
Temporary. Created immediately upon opening a file and deleted automatically upon successful exit (:q or :wq).
</td>
<td>
Permanent. Created upon saving (:w) and kept until manually deleted.
</td>
</tr>
<tr>
<td>
Litter
</td>
<td>
No (unless Vim crashes or you force-quit).
</td>
<td>
Yes (they are meant to be kept for history).
</td>
</tr>
</table>

<div id="Explanation of The Swap File Block"><h1 id="Explanation of The Swap File Block" class="header"><a href="#Explanation of The Swap File Block">Explanation of The Swap File Block</a></h1></div>

<p>
The vimrc configuration for swap files ensures they are centralized and organized, preventing them from cluttering your working directories.
</p>

<pre vim>
if isdirectory($HOME . '/.vim/swap') == 0
    :silent !mkdir -p ~/.vim/swap
endif
if isdirectory($HOME . '/.vim/swap')
    set directory=./.vim-swap//
    set directory+=~/.vim/swap//
    set directory+=~/tmp//
    set directory+=.
    set swapfile
endif
</pre>

<div id="Explanation of The Swap File Block-Directory Creation"><h4 id="Directory Creation" class="header"><a href="#Explanation of The Swap File Block-Directory Creation">Directory Creation</a></h4></div>

<ul>
<li>
The first <code>if</code>/<code>endif</code> block checks for and creates the directory ~/.vim/swap to hold all swap files.

</ul>
<div id="Explanation of The Swap File Block-Location Configuration"><h4 id="Location Configuration" class="header"><a href="#Explanation of The Swap File Block-Location Configuration">Location Configuration</a></h4></div>
<ul>
<li>
<code>set directory=./.vim-swap//</code>: This command is key. It defines the first, highest-priority location where Vim should try to put a swap file.

<li>
The use of double slashes (<code>//</code>) at the end is very important: It tells Vim to append the full path of the file being edited to the swap file's name, but with path separators replaced by percent signs (<code>%</code>). This ensures that every file, no matter its location, has a unique swap file name inside the centralized directory (e.g., <code>/home/user/project/file.txt</code> becomes <code>~/.vim/swap/home%user%project%file.txt.swp</code>).

<li>
<code>set directory+=...</code>: This adds fallback locations to the list:

<ul>
<li>
<code>~/.vim/swap//</code>: Your central swap directory, also using unique naming.

<li>
<code>~/tmp//</code>: Another temporary directory for a fallback.

<li>
<code>.</code>: The current working directory (the lowest priority, used if all others fail).

</ul>
<li>
<code>set swapfile</code>: This explicitly enables the swap file feature. (It is usually on by default, but explicitly setting it is good practice).

</ul>
<p>
In short, the Swap File block ensures your safety files are created and maintained for crash recovery, but are cleanly tucked away in a dedicated directory.
</p>

<p>
<a href="vim_learning.html">Vim Learning</a>
</p>

<p>
<a href="index.html">index</a>
</p>

</body>
</html>
